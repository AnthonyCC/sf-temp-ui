<script>
            
      var editPanel;
      var waitPanel;
      var map;
      var currentAddress;
      var defaultZoomLevel = 15;
                  
      var jsonrpcClient = new JSONRpcClient("geographyprovider.ax");
      
            
      function init() {
        editPanel = new YAHOO.widget.Panel("panel-1", {       
                          width: "860px", 
                          fixedcenter: true, 
                          close: true, 
                          draggable: false, 
                          zindex:4,
                          modal: true,
                          visible: false,
                          effect:{effect:YAHOO.widget.ContainerEffect.SLIDE,duration:0.25}});
        
        editPanel.render();
        
        waitPanel = new YAHOO.widget.Panel("wait", { width: "240px", 
                                                          fixedcenter: true, 
                                                          close: true, 
                                                          draggable: false, 
                                                          zindex:4,
                                                          modal: true,
                                                          visible: false
                                                        } 
                                                    );
        
        waitPanel.setHeader("Loading, please wait...");
        waitPanel.setBody("<img src=\"images/rel_interstitial_loading.gif\"/>");
        
        map = new GMap2(document.getElementById("map_canvas"));
      
	     map.addControl(new GSmallMapControl());
		 map.addControl(new GMapTypeControl());
		 map.enableDragging();
		 
	}
       
              
      function showBoundary(boundaryKey) {          
        
          waitPanel.render(document.body);
          waitPanel.show();
        
    	  var result = loadData(jsonrpcClient, showBoundaryCallback, boundaryKey); 
      	  
      }
      
      function showBoundaryCallback(result, exception) {
      	  map.clearOverlays();
          if(exception) { 
              waitPanel.hide();
              alert('Unable to connect to host system. Please contact system administrator!');               
              return;
          }
          
          var polyPoints = [];
		  var polygonDepth = "20";
		  var fillColor = "#0000FF"; // blue fill
		  var lineColor = "#000000"; // black line
	      var opacity = .5;
	      var lineWeight = .5; 
	      
          waitPanel.hide();
          
          var centerpoint = new GLatLng(result.center['y'], result.center['x']);
          map.setCenter(centerpoint, 12);
          
          var markerCenter = createMarker(centerpoint,"P",(result.code+"<br/>"+result.name));
          map.addOverlay(markerCenter);
          
          if(result.geoloc.list != null) {
          	for (i=0; i < result.geoloc.list.length; i++) {
          	 	var tmpPoint = result.geoloc.list[i];          	 	
          		polyPoints.push(new GLatLng(tmpPoint['y'], tmpPoint['x']));
          	}          	          	
          }
          
          var polyShape = new GPolygon(polyPoints,lineColor,lineWeight,opacity,fillColor,opacity);
          map.addOverlay(polyShape);
		                       
		  map.setZoom(defaultZoomLevel); 	                    
          editPanel.render(document.body);    
          //editPanel.moveTo(450, 200);
          editPanel.show();
      }
      
      function plotPoint(type) {
      	if('A' == type) {
      		// Create new geocoding object
      	   var geocoder = new GClientGeocoder();
		   currentAddress = document.getElementById('address').value;
	       // Retrieve location information, pass it to addToMap()
    	   geocoder.getLocations(document.getElementById('address').value, addToMap);
      
      	   
      	} else {
      	   var centerpoint = new GLatLng(document.getElementById('latitude').value, document.getElementById('longitude').value);
	       map.setCenter(centerpoint, 12);
	          
	       var markerCenter = createMarker(centerpoint,"P",
	       							("Latitude="+document.getElementById('latitude').value+"<br/>"+"Longitude="+document.getElementById('longitude').value));
	       map.addOverlay(markerCenter);
      	}
      }
      
       function addToMap(response)  {      
		  var place = response.Placemark[0];
	      var addressPoint = new GLatLng(place.Point.coordinates[1],
	                          place.Point.coordinates[0]);
	
	      // Center the map on this point
	      map.setCenter(addressPoint, 12);
	            
	               
	      var addressMarker = createMarker(addressPoint,"A",currentAddress+"<br/>"
	      					+("Latitude="+place.Point.coordinates[1]+"<br/>"+"Longitude="+place.Point.coordinates[0]));
	
	      // Add the marker to map
	      map.addOverlay(addressMarker);

   }
      
      function createMarker(point, letterCode, info) {
		var baseIcon = new GIcon();
		baseIcon.shadow = "http://www.google.com/mapfiles/shadow50.png";
		baseIcon.iconSize = new GSize(20, 34);
		baseIcon.shadowSize = new GSize(37, 34);
		baseIcon.iconAnchor = new GPoint(9, 34);
		baseIcon.infoWindowAnchor = new GPoint(9, 2);
		baseIcon.infoShadowAnchor = new GPoint(18, 25);     	
		  // Create a lettered icon for this point using our icon class
		  var letter = String.fromCharCode(letterCode.charCodeAt(0));
		  var letteredIcon = new GIcon(baseIcon);
		  letteredIcon.image = "http://www.google.com/mapfiles/marker" + letter + ".png";
		
		  // Set up our GMarkerOptions object
		  markerOptions = { icon:letteredIcon, draggable: true };
		  var marker = new GMarker(point, markerOptions);
		
		  GEvent.addListener(marker, "click", function() {
		    marker.openInfoWindowHtml(info);
		  });
		  return marker;
      } 
      
      
      
      YAHOO.util.Event.addListener(window, "load", init);
      YAHOO.util.Event.addListener(window, "unload", GUnload);
    </script>
   
    <div id="wait"></div>
    <form name="panel-1-form" id="panel-1-form" method="post">
      <div id="panel-1">
      <div class="hd"><img src="images/gmap-icon.gif" width="16" height="16" border="0" alt="Gmap" align="absmiddle" />&nbsp;Geography Boundary</div>
      <div class="bd">
      <p>
      	Latitude:<input type="text" size="20" id="latitude" value="" />&nbsp;&nbsp;Longitude:<input type="text" size="20" id="longitude" value="" />
	    <input type="button" value="Locate!" onclick="javascript:plotPoint('P')" />
	    &nbsp;&nbsp;
	    <input type="text" size="40" id="address" value="2330 BORDEN AVE, 11101, NY"  />
	    <input type="button" value="Locate!" onclick="javascript:plotPoint('A')" />
	    
 	 </p>
      
                <div id="map_canvas" style="width: 840px; height: 600px"></div>
        </div>
    </div>