<%@page import="com.freshdirect.webapp.util.ProductImpression"%>
<%@page import="com.freshdirect.fdstore.content.ContentNodeModel"%>
<%@page import="com.freshdirect.fdstore.DealsHelper"%>
<%@page import="com.freshdirect.fdstore.content.Html"%>
<%@page import="java.util.Iterator"%>
<%@page import="com.freshdirect.fdstore.content.Image"%>
<%@page import="com.freshdirect.fdstore.content.CategoryModel"%>
<%@page import="com.freshdirect.fdstore.content.DepartmentModel"%>
<%@page import="com.freshdirect.webapp.util.JspMethods"%>
<%@page import="com.freshdirect.fdstore.content.SkuModel"%>
<%@page import="java.util.Collections"%>
<%@page import="com.freshdirect.fdstore.content.ProductModel"%>
<%@page import="com.freshdirect.fdstore.content.ContentFactory"%>
<%@page import="java.util.Comparator"%>
<%@page import="java.util.ArrayList"%>
<%@page import="java.util.List"%>
<%@page import="com.freshdirect.fdstore.content.ProductContainer"%>
<%@page import="com.freshdirect.webapp.taglib.fdstore.SessionName"%>
<%@page import="com.freshdirect.webapp.taglib.fdstore.FDSessionUser"%>
<%@page import='com.freshdirect.fdstore.pricing.ProductPricingFactory' %>
<%@page import ='com.freshdirect.fdstore.customer.*'%>

<%@ taglib uri='freshdirect' prefix='fd' %>
<%@ taglib uri="/WEB-INF/shared/tld/fd-display.tld" prefix='display' %>


<%-- Featured Products column --%>

<%
	DepartmentModel department = (DepartmentModel) currentFolder;

	int FAVS_PER_LINE		= DealsHelper.getMaxFeaturedDealsPerLine(); 				//number of products to show per line
	int MAX_FAVSLINES2SHOW	= DealsHelper.getMaxFeaturedDealsForPage()/FAVS_PER_LINE; 	//number of lines of featured products
	int MIN_FAVS2SHOW		= DealsHelper.getMinFeaturedDealsForPage(); 				//minimum featured products required to show featured section
	int	MAX_FAVS2SHOW		= FAVS_PER_LINE * MAX_FAVSLINES2SHOW; 						//to keep each row matching
%>

<display:FeaturedProductsHelper currentFolder="<%=(DepartmentModel)currentFolder%>" maxFavsToShow="<%=MAX_FAVS2SHOW%>"/>

<% if (true || favoritesToShow >= MIN_FAVS2SHOW) { %>
	<!-- separator  -->
	<tr><td colspan="6">
		<br /><img src="/media_stat/images/layout/cccccc.gif" width="550" height="1" border="0"><br />
		<font class="space4pix"><br /><br /></font>
	</td></tr>

	<!-- department middle media -->
	<tr><td colspan="6">
        <%
		if (department.getDepartmentMiddleMedia() != null) {
			for(Iterator<Html> deptBotItr = department.getDepartmentMiddleMedia().iterator(); deptBotItr.hasNext();) {
				Html piece = deptBotItr.next();
				if (piece != null) {
		        	String deptBotItm = piece.getPath();
					%><fd:IncludeMedia name='<%= deptBotItm %>' /><%
		    	}
			}
		}
        %>
	</td></tr>
	
	<!-- brand name deals -->
	<fd:ProductGroupRecommender siteFeature="BRAND_NAME_DEALS" facility="what_is_facility" currentNode="<%= department %>" id="brandDealRecommendations">	
		<tr><td colspan="6">
			<display:Carousel id="test_carousel" carouselId="test_carousel" width="510" numItems="4" showCategories="false" itemsToShow="<%= brandDealRecommendations.getAllProducts() %>" trackingCode="test-brand-name-deals" maxItems="20">
				<display:GetContentNodeWebId id="webId" product="<%= currentItem %>" clientSafe="<%= true %>">
					<display:ProductImage product="<%= (ProductModel)currentItem %>" showRolloverImage="true" action="<%= actionUrl %>" 
						useAlternateImage="false" className="productImage" height="90" enableQuickBuy="false"/>
					<display:ProductRating product="<%= (ProductModel)currentItem %>" action="<%= actionUrl %>"/>
					<div class="productname">
						<display:ProductName product="<%= (ProductModel)currentItem %>" action="<%= actionUrl %>" showBrandName="true" />
					</div>
					<display:ProductPrice impression="<%= new ProductImpression((ProductModel)currentItem) %>" showDescription="false"/>	
				</display:GetContentNodeWebId>
			</display:Carousel>
		</td></tr>	
	</fd:ProductGroupRecommender>
        
	<!-- department bottom media -->
	<tr><td colspan="6">
		<%    
		if( department.getDepartmentBottom() != null ) {
			for(Iterator<Html> deptBotItr = department.getDepartmentBottom().iterator(); deptBotItr.hasNext();) {
				Html piece = deptBotItr.next();
				if (piece != null) {
				   	String deptBotItm = piece.getPath();
					%><fd:IncludeMedia name='<%= deptBotItm %>' /><%
				}
			}
       	} %>    
	</td></tr>
<% } %>
		