<%--
	Cart'N'Tabs flattened UI layout
	
	@author segabor
	
	
	@param smartStoreFacility

 --%>
<%@ taglib uri='freshdirect' prefix='fd' %>
<%@ taglib uri='logic' prefix='logic' %>
<fd:css href="/assets/css/cartntabs/cartntabs.css" />
<fd:javascript src="/assets/javascript/cartntabs.js"/>
<fd:GetCartNTabsWidth><fd:PIPTab id="tab" maxTabs="3" maxRecommendations="5" facility="<%= smartStoreFacility %>">
<%
	final int nTabs = tab.size();

	final Variant __v_top = nTabs > 0 ? tab.get(0) : null;
	final Variant __v_left = nTabs > 1 ? tab.get(1) : null;
	final Variant __v_right = nTabs > 2 ? tab.get(2) : null;
	
	
	request.setAttribute("actionResult", result);
    request.setAttribute("globalCartProdHeight", 110);
%>
<div class="cartntabs"><div class="cnt-flatbox-full" style="width: <%= tabsTotalWidth %>px;">
<%
	if (__v_top != null) {
		request.setAttribute("genericRecommendationsVariant", __v_top);
	    request.setAttribute("parentImpressionId", tab.getParentImpressionId());
	    request.setAttribute("parentVariantId", tab.getTabVariant().getId());
	    request.setAttribute("maxItems", 5);
%>
		<h2 class="centerline">
		  <span><%= __v_top.getServiceConfig().getPresentationTitle() %></span>
		</h2>
		<div id="header_<%= __v_top.getId() %>" class="tab_text_descr"><%= tab.getTabDescription(0) %></div>
		<div id="content_<%= __v_top.getId() %>">
<jsp:include page="/includes/smartstore/cartntabs_content.jsp">
<jsp:param value="<%= smartStoreFacility %>" name="smartStoreFacility"/>
</jsp:include>
		</div>
<%
	}
%>
</div>
<% if (nTabs == 2) { %>
<div class="cnt-flatbox-full" style="width: <%= tabsTotalWidth %>px;">
<%
	if (__v_left != null) {
		request.setAttribute("genericRecommendationsVariant", __v_left);
	    request.setAttribute("parentImpressionId", tab.getParentImpressionId());
	    request.setAttribute("parentVariantId", tab.getTabVariant().getId());
	    request.setAttribute("maxItems", 5);
%>		
		<h2 class="centerline">
		  <span><%= __v_left.getServiceConfig().getPresentationTitle() %></span>
		</h2>
		<div id="header_<%= __v_left.getId() %>" class="tab_text_descr"><%= tab.getTabDescription(1) %></div>
		<div id="content_<%= __v_left.getId() %>">
<jsp:include page="/includes/smartstore/cartntabs_content.jsp">
<jsp:param value="<%= smartStoreFacility %>" name="smartStoreFacility"/>
</jsp:include>
		</div>
<%
	}
%>
</div>
<% } else if (nTabs >= 3) { %><div style="width: <%= tabsTotalWidth %>px; border: 0; margin: 0; padding: 0"><%
	final int __halfWidth = (tabsTotalWidth-2-80)/2;
%><span class="cnt-flatbox-half" style="width: <%= __halfWidth %>px;">
<%
		request.setAttribute("genericRecommendationsVariant", __v_left);
	    request.setAttribute("parentImpressionId", tab.getParentImpressionId());
	    request.setAttribute("parentVariantId", tab.getTabVariant().getId());
	    request.setAttribute("maxItems", 2);
%>		
		<div class="cnt-flatbox-center-left">
			<h2 class="centerline">
			  <span><%= __v_left.getServiceConfig().getPresentationTitle() %></span>
			</h2>
		</div>
		<div id="header_<%= __v_left.getId() %>" class="tab_text_descr"><%= tab.getTabDescription(1) %></div>
		<div id="content_<%= __v_left.getId() %>" class="cnt-flatbox-ctnt" style="width: <%= __halfWidth %>px;">
<jsp:include page="/includes/smartstore/cartntabs_content.jsp">
<jsp:param value="<%= smartStoreFacility %>" name="smartStoreFacility"/>
</jsp:include>
		</div>
	</span><span class="cnt-flatbox-column">
		<div class="cnt-sep-top"></div>
		<div class="cnt-sep-bar"></div>
	</span><span class="cnt-flatbox-column"></span><span class="cnt-flatbox-half" style="width: <%= __halfWidth %>px;">
<%
		request.setAttribute("genericRecommendationsVariant", __v_right);
	    request.setAttribute("parentImpressionId", tab.getParentImpressionId());
	    request.setAttribute("parentVariantId", tab.getTabVariant().getId());
	    request.setAttribute("maxItems", 2);
%>
		<div class="cnt-flatbox-center-right">
			<h2 class="centerline">
			  <span><%= __v_right.getServiceConfig().getPresentationTitle() %></span>
			</h2>
		</div>
		<div id="header_<%= __v_right.getId() %>" class="tab_text_descr"><%= tab.getTabDescription(2) %></div>
		<div id="content_<%= __v_right.getId() %>" class="cnt-flatbox-ctnt">
<jsp:include page="/includes/smartstore/cartntabs_content.jsp">
<jsp:param value="<%= smartStoreFacility %>" name="smartStoreFacility"/>
</jsp:include>
		</div>
	</span></div>
<% } %></div>
<script type="text/javascript">
var PIP;

YAHOO.util.Event.onDOMReady(function(){
	var __tabVariants = [], __v2sf = {}, __impressionIds = [];

<%
	for (int k=0; k<nTabs; k++) {
		Variant _tv = tab.get(k);
%>
__tabVariants.push('<%= _tv.getId() %>');
	__v2sf['<%= _tv.getId() %>'] = '<%= _tv.getSiteFeature().getName() %>';
	__impressionIds.push('<%= tab.getFeatureImpressionId(k) %>');
<% } %>

	PIP = new PipClass(
		'<%= smartStoreFacility %>',
		'<%= response.encodeURL(request.getRequestURL().toString().replaceFirst("^[^:]*://[^/]*/", "/")) %>',
		__tabVariants, __v2sf, __impressionIds,
		'<%= tab.getParentImpressionId() + ':' + tab.getTabVariant().getId() %>',
		'<%= tab.get(selectedTabIndex.intValue()).getId() %>'
	);

	PIP.attachHandlers();
});
</script>
</fd:PIPTab></fd:GetCartNTabsWidth>
