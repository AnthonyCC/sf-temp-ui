<%@ taglib uri='freshdirect' prefix='fd' %>
<%@ page import='com.freshdirect.webapp.taglib.fdstore.*' %>
<%@ page import='com.freshdirect.fdstore.customer.*' %>
<%@ page import='com.freshdirect.framework.webapp.*' %>
<%@ page import='com.freshdirect.framework.util.StringUtil' %>
<%@ page import='com.freshdirect.common.customer.EnumServiceType' %>

<%
	String uri = request.getRequestURI();
	String successPage = request.getParameter("successPage");
	if (successPage == null) {      
		FDSessionUser user = (FDSessionUser) session.getAttribute(SessionName.USER);
        if (user!=null && EnumServiceType.CORPORATE.equals(user.getUserServiceType())) {
          successPage = "/department.jsp?deptId=COS";
        }else{
		    successPage = "/login/index.jsp";
        }
	}
%>
<fd:LoginController successPage="<%= successPage %>" mergePage="/login/merge_cart.jsp" result='result'>

<%!
String[] checkLoginForm = {"userid", "email_format", "password"};
String[] checkErrorType = {"authentication", "technical_difficulty"};
%>

<fd:ErrorHandler result='<%=result%>' field='<%=checkLoginForm%>'>
	<% String errorMsg = SystemMessageList.MSG_MISSING_INFO; %>	
	<%@ include file="/includes/i_error_messages.jspf" %>	
</fd:ErrorHandler>

<fd:ErrorHandler result='<%=result%>' field='<%=checkErrorType%>' id='errorMsg'>
	<%@ include file="/includes/i_error_messages.jspf" %>	
</fd:ErrorHandler>

<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0">
<form name="fd_login" method="post" action="<%= request.getRequestURI()+"?"+StringUtil.escapeXssUri(request.getQueryString()) %>">
<TR>
	<TD width="110" ALIGN="right" class="text13">* E-mail Address&nbsp;</TD>
	<TD width="125"><input name="userid" size="14" style="width: 140px" type="text" required="true" maxlength="128" tabindex="1" class="text11" value="<%= request.getParameter("userid")!=null ? request.getParameter("userid") : ""%>"></td> 
	<td></td>
	<td class="text11rbold" width=220>
	<fd:ErrorHandler result='<%=result%>' name='userid' id='errorMsg'><span class="text11rbold"><%=errorMsg%></span></fd:ErrorHandler>
	<fd:ErrorHandler result='<%=result%>' name='email_format' id='errorMsg'><span class="text11rbold"><%=errorMsg%></span></fd:ErrorHandler>
	</TD>
	<TD WIDTH="30" rowspan="3"><IMG src="/media_stat/images/layout/clear.gif" WIDTH="30" HEIGHT="1" BORDER="0"><BR></TD>
</TR>
<TR VALIGN="MIDDLE">
	<TD width="110" ALIGN="right" class="text13">* Password&nbsp;</TD>
	<TD><input name="password" size="14" style="width: 140px" type="password" required="true" tabindex="2" class="text11"></TD>
	<td>
		<input type="image" src="/media_stat/images/template/homepages/go_round.gif"" width="18" height="18" name="check_access" border="0" alt="GO" hspace="4" tabindex="3">
	</td>
	<TD>
	<fd:ErrorHandler result='<%=result%>' name='password' id='errorMsg'><span class="text11rbold"><%=errorMsg%></span></fd:ErrorHandler>
	</TD>
</TR>
<TR VALIGN="MIDDLE">
		<TD WIDTH="110"><IMG src="/media_stat/images/layout/clear.gif" WIDTH="110" HEIGHT="1" BORDER="0"></TD>
		<TD colspan=3 CLASS="text13">Passwords are case sensitive.</TD>
</TR>
</form>
</TABLE>

</fd:LoginController>

