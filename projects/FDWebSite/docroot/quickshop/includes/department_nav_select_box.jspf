<%//build department navigation

StringBuffer departmentNav = new StringBuffer();
List storeDepartments = ContentFactory.getInstance().getStore().getDepartments();
String currentDepartment = ""; 


if (storeDepartments.size() > 0) {
	Collections.sort(storeDepartments, DepartmentModel.DepartmentNameComparator);

	showLink = !hasDeptId || !qsDeptId.equalsIgnoreCase("all");

	if (showLink) { 
		departmentNav.append("<OPTION VALUE=\"");
		departmentNav.append("/quickshop/every_item.jsp?qsDeptId="); 
		departmentNav.append("all");
		departmentNav.append("\">");
		departmentNav.append("ALL DEPARTMENTS");
	}

	for (Iterator dIter = storeDepartments.iterator(); dIter.hasNext();) {
		DepartmentModel thisDept = (DepartmentModel) dIter.next();

	%>	<fd:QuickShopController id="qCart" orderId="every" action="">
	<%      // checks if customer has shopped from this dept.  If not, don't show dept. APPDEV-203
		if( !qCart.getProducts(thisDept.getContentName()).isEmpty()) {

			showLink = !hasDeptId || !thisDept.getContentName().equalsIgnoreCase(qsDeptId);

			if (!thisDept.isHidden() && "[big], [test_picks], [our_picks], [about], [spe], [mkt], [kosher_temp], [tea], [pas], [cmty]".indexOf("["+thisDept.getContentName().toLowerCase()+"]")== -1 ) {
				if (showLink) { 
					departmentNav.append("<OPTION VALUE=\"");
					departmentNav.append("/quickshop/every_item.jsp?qsDeptId="); 
					departmentNav.append(thisDept.getContentName());
					departmentNav.append("\"");
					departmentNav.append(">"+thisDept.getFullName());
				}

			}
		}
		%></fd:QuickShopController><%
	} 
}
%>
