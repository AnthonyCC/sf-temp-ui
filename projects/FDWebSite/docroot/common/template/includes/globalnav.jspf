<%@page import="com.bea.wls.ejbgen.template.Context"%>
<%@ page import='java.util.*'%>
<%@ page import='com.freshdirect.fdstore.content.*'%>
<%@ page import='com.freshdirect.fdstore.customer.*'%>
<%@ page import='com.freshdirect.webapp.taglib.fdstore.*'%>
<%@ page import='com.freshdirect.webapp.util.*'%>
<%@ page import='com.freshdirect.fdstore.*'%>
<%@ page import='com.freshdirect.fdstore.rollout.EnumRolloutFeature' %>
<%@ page import='com.freshdirect.fdstore.rollout.FeatureRolloutArbiter' %>
<%@ page import='java.net.*'%>
<%@ taglib uri='oscache' prefix='oscache' %>
<%@ taglib uri="fd-data-potatoes" prefix="potato" %>

<potato:navigationhighlight/>
<% FDUserI user = (FDUserI)session.getAttribute(SessionName.USER); 
/* move global nav to media
 *	this may need code support from time to time (when new items are added)
 */
 	
 	String navigation = pageContext.getAttribute("navigation").toString();
	
%>
<% if(FeatureRolloutArbiter.isFeatureRolledOut(EnumRolloutFeature.globalnav2014, user)) { %>
	<script type="text/javascript">
		FreshDirect = FreshDirect || {};
		FreshDirect.globalnav = FreshDirect.globalnav || {};
		FreshDirect.globalnav.curNav = '<%=navigation%>';
	</script>
    <jwr:script src="/fdlibsyui.js"  useRandomParam="false" />
	<%@ include file="/common/template/includes/globalnav_sr.jspf" %>
<% } else { %>

<% //expanded page dimensions
final int W_GLOBAL_NAV_TOTAL = 970;
%>
<center>
<%@ include file="/common/template/includes/globalnav_top.jspf" %>

<oscache:cache key='<%= "globalNav_"+request.getQueryString() %>' time='0'>
<% try { 
	Map<String, String> params = new HashMap<String, String>();
	params.put("curNav", navigation);
%>
<table width="<%=W_GLOBAL_NAV_TOTAL %>" border="0" cellpadding="0" cellspacing="0">
<tr><td>
<fd:IncludeMedia name="/media/layout/nav/top_nav.ftl" parameters="<%= params %>">
	<%-- no media, include code version --%>
	<%@ include file="/common/template/includes/globalnav_table.jspf" %>
</fd:IncludeMedia>
</td></tr><tr><td class="threePxTall"><img src="/media_stat/images/layout/clear.gif" width="1" height="3" alt="" /></td></tr></table>
<% } catch (Exception ex) {
		ex.printStackTrace();
%><oscache:usecached />
<% } %></oscache:cache>
</center>
<% }
%>
