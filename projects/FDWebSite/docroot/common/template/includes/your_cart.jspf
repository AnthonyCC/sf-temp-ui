<%@ page import="com.freshdirect.fdstore.customer.FDUserI"%>
<%@ page import="com.freshdirect.fdstore.customer.FDCartModel"%>
<%@ page import="com.freshdirect.fdstore.customer.FDModifyCartModel"%>
<%@ page import="com.freshdirect.fdstore.customer.FDCartLineI"%>
<%@ page import="com.freshdirect.webapp.taglib.fdstore.SessionName"%>
<%@ page import="com.freshdirect.webapp.util.JspMethods"%>
<%@ taglib uri='freshdirect' prefix='fd' %>

<% //expanded page dimensions
final int W_CART_TOTAL = 191;
final int W_CART_SIDE = 10;
final int W_CART_TEXT_PADDING = 10;
final int W_CART_LOWER_LINE_PADDING= 10;
%>


<%
	final FDUserI __yc_user = (FDUserI)session.getAttribute(SessionName.USER);
%>
<fd:GetCart id='cart'>
    <table border="0" cellspacing="0" cellpadding="0" width="<%=W_CART_TOTAL%>">
        <tr>
            <td colspan="3" width="<%=W_CART_TOTAL%>"><a href="/view_cart.jsp?trk=sidcrt" id="your_cart"><img src="/media_stat/images/template/lists/cart_hdr.gif" width="<%=W_CART_TOTAL%>" height="18" border="0" alt="Your Cart"></a><br>
            <table border="0" cellspacing="0" cellpadding="0" width="<%=W_CART_TOTAL%>">
                <tr valign="top" style="background-color: #FF9933;">
                    <td width="<%=W_CART_SIDE%>"><img src="/media_stat/images/template/lists/cart_lft.gif" width="<%=W_CART_SIDE%>" height="16" border="0"></td>
                    <td width="<%=W_CART_TOTAL - 2 * W_CART_SIDE%>" valign="middle" style="background-color: #fff;" align="center">Subtotal: <span class="text11bold"><%= JspMethods.formatPrice(cart.getSubTotal()) %></span></td>
                    <td width="<%=W_CART_SIDE%>"><img src="/media_stat/images/template/lists/cart_rt.gif" width="<%=W_CART_SIDE%>" height="16" border="0"></td>
                </tr>
                <tr valign="top">
                    <td width="<%=W_CART_TOTAL%>" colspan="3" bgcolor="#FF9933"><img src="/media_stat/images/layout/ff9933.gif" width="1" height="4"></td>
                </tr>
            </table>
            </td>
        </tr>  
        <tr>
            <td bgcolor="#FF9933" valign="bottom" width="1"><img src="/media_stat/images/layout/ff9933.gif" 
                width="1" height="1"><br></td>
            <td align="center" width="<%=W_CART_TOTAL - 2%>"><img src="/media_stat/images/layout/clear.gif"  
                width="<%=W_CART_TOTAL - 2%>" height="7"><br>
                <!-- nested table with content -->
                <table width="<%=W_CART_TOTAL - 2%>" cellpadding="0" cellspacing="0" border="0">
                    <tr>
                        <td width="<%=W_CART_TEXT_PADDING%>">&nbsp;</td>
                        <td width="<%=W_CART_TOTAL - 2 - W_CART_TEXT_PADDING%>" class="text9_lh12">
	                        <%	if (cart instanceof FDModifyCartModel){ %>
		                        <div>You are changing a placed order.  <a href="/view_cart.jsp?trk=sidcrt">Click for details</a>.</div>
	                        <%
	                        	}

								String lastDept = null;
								boolean firstRecipe = true;
								
								for (FDCartLineI orderLine : cart.getOrderLines()) {
							%>
								<fd:ProductGroup id='productNode' categoryId='<%= orderLine.getCategoryName() %>' productId='<%= orderLine.getProductName() %>'>
									<%
										if (lastDept==null || !lastDept.equalsIgnoreCase(orderLine.getDepartmentDesc())) {
											lastDept = orderLine.getDepartmentDesc();  %>
								<div style="font-weight: bold; padding-top: 1em;"><%= lastDept %></div>
									<% } %>
								<a style="display: block" href="/product_modify.jsp?cartLine=<%=orderLine.getRandomId()%>&skuCode=<%=orderLine.getSku().getSkuCode()%>&trk=sidcrt" title="<%=productNode.getFullName().replace("\"","&quot;")%>"><%= productNode.getGlanceName() %></a>
								</fd:ProductGroup>             
							<%
								}
							%>
                        </td>
                    </tr>
                </table>
                <br>
                <a style="display: block" href="/view_cart.jsp?trk=sidcrt"><img src="/media_stat/images/template/lists/cart_lg.gif" width="67" height="56" border="0" alt="Shopping Cart"></a>
				<img src="/media_stat/images/layout/cccccc.gif" width="<%=W_CART_TOTAL - 2 * W_CART_LOWER_LINE_PADDING%>" height="1" VSPACE="10"><font class="space4pix"><br></font>
<% 
	if (__yc_user != null && __yc_user.getIdentity() !=null) { %>
	        <fd:CustomerCreditHistoryGetterTag id='customerCreditHistory'>
	            <% if (customerCreditHistory.getRemainingAmount()>0.00) { %>
	            <div class="text11"><%= JspMethods.formatPrice(customerCreditHistory.getRemainingAmount()) %> credit will be applied at Checkout.</div>
	  			<% } %>
	       </fd:CustomerCreditHistoryGetterTag>
<% } %>
                <font class="text12bold"><a href="/checkout/view_cart.jsp?trk=sidcrt">Check Out</A></font><br><font class="space4pix"><br></font>
                <!-- end nested table with content -->
            </td>
            <td bgcolor="#FF9933" valign="bottom" width="1"><img src="/media_stat/images/layout/ff9933.gif" 
                width="1" height="1"></td>
        </tr>
        <% if (lastDept != null) { %>
        <tr valign="top">
            <td width="<%=W_CART_TOTAL%>" colspan="3">
                <table border="0" cellspacing="0" cellpadding="0" width="<%=W_CART_TOTAL%>">
                    <tr valign="top">
                    	<td width="<%=W_CART_TOTAL%>" colspan="3" bgcolor="#FF9933"><img src="/media_stat/images/layout/ff9933.gif" width="1" height="4"></td>
                    </tr>
                    <tr valign="top" style="background-color: #FF9933;">
                        <td width="<%=W_CART_SIDE%>"><img src="/media_stat/images/template/lists/cart_lft.gif" width="<%=W_CART_SIDE%>" height="17" border="0"></td>
                        <td width="<%=W_CART_TOTAL - 2 * W_CART_SIDE%>" valign="middle" style="background-color: #fff;" align="center">Subtotal: <span class="text11bold"><%= JspMethods.formatPrice(cart.getSubTotal()) %></span></td>
                        <td width="<%=W_CART_SIDE%>"><img src="/media_stat/images/template/lists/cart_rt.gif" width="<%=W_CART_SIDE%>" height="17" border="0"></td>
                    </tr>
                    <tr valign="top">
                        <td width="<%=W_CART_TOTAL%>" colspan="3" bgcolor="#FF9933"><img src="/media_stat/images/template/lists/cart_btm_crnrs.gif" width="<%=W_CART_TOTAL%>" height="5" border="0"></td>
                    </tr>
                </table>
            </td>
        </tr>
		<% } else { %>
		<tr valign="top">
			<td width="<%=W_CART_TOTAL%>" colspan="3"><img src="/media_stat/images/template/lists/cart_btm_crnrs2.gif" width="<%=W_CART_TOTAL%>" height="5" border="0"></td>
		</tr>
<% } %>
	</table>
</fd:GetCart>
