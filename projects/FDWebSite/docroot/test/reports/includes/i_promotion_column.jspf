<%
ProductModel pm = null;
int c = 0;
String displayName = "";
boolean unavail = false;

Banner banner = (Banner) bannerAttr.getValue();

if (banner.isSubjectALink() && banner.getContentLink()!=null) {
    System.out.println(banner.getContentLink());
    displayName = "<a href='"+  banner.getContentLink() + "'>" + banner.getContentLink() + "</a>";
} else {    
    ContentRef subject = banner.getSubject();


    if (subject != null) {
        ContentNodeModel cNode = null;
        if (subject instanceof ProductRef) {
            cNode = ((ProductRef)subject).lookupProduct();
            pm = (ProductModel)cNode;
            unavail = pm.isUnavailable();
        } else if(subject instanceof DepartmentRef){
            cNode = ((DepartmentRef)subject).getDepartment();
        }else{
            cNode = ((CategoryRef)subject).getCategory();
        }
        
        if (cNode != null) {
            displayName = cNode.getFullName();
        } else{
            displayName = "unreachable name";
        }
    }
}
%>
    <table CLASS="noBorder">
        <tr>
            <td CLASS="noBorder"><%= ++c %></td><td CLASS="noBorder">&nbsp;&nbsp;</td>
            <td CLASS="noBorder"><%= unavail?"<i>":"" %><%= displayName %><%= unavail?"</i>":"" %></td>
            <td CLASS="noBorder">&nbsp;&nbsp;</td>
            <td align=right CLASS="noBorder">
<%  if(pm != null && !unavail){
    SkuModel defaultSku = pm.getSku(0);
    if (defaultSku != null && !unavail) {
        FDProductInfo prdInfo = FDCachedFactory.getProductInfo(defaultSku.getSkuCode());
%>
            <%= currencyFormatter.format(prdInfo.getDefaultPrice()) %>/<%= prdInfo.getDisplayableDefaultPriceUnit().toLowerCase() %>
<%
            }
        }
%>
            </td>
        </tr>
    </table>
