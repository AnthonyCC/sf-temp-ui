{namespace expressco}

/**
 * @param subTotalBox subtotal
 * @param subTotal
 * @param cartSections List of cart sections
 * @param? additionalInfo Promotion info
 * @param? goGreen go green state
 * @param? userRecognized is the user recognized?
 * @param? userCorporate
 * @param? deliveryPassTrialExpired
 * @param? promotionApplied
 * @param? couponMessage subtotal
 * @param populateDCPDPromoDiscount
 * @param? customerServiceRepresentative
 * @param? tipAmounts
 * @param? tipApplied
 * @param? tipAppliedTick
 * @param customTip customTip
 * @param avalaraEnabled avalaraEnabled
 * @param eTippingEnabled eTippingEnabled
 * @param etipTotal eTipTotal
 * @param containsWineSection containsWineSection
 */
{template .viewcartlines autoescape="false"}
	{call .couponMessage}
		{param couponMessage: $couponMessage /}
	{/call}
	<div class='cartcontent'>
		{foreach $section in $cartSections}
			{call .cartsection data="$section"}
				{param cartlineType: 'YOUR_CART' /}
				{param populateDCPDPromoDiscount: $populateDCPDPromoDiscount /}
				{param tipAmounts: $tipAmounts /}
				{param tipApplied: $tipApplied /}
				{param tipAppliedTick: $tipAppliedTick /}
				{param subTotalBox: $subTotalBox /}
				{param subTotal: $subTotal /}
				{param userRecognized: $userRecognized /}
				{param userCorporate: $userCorporate /}
				{param etipTotal: $etipTotal /}
				{param customTip: $customTip /}
				{param eTippingEnabled: $eTippingEnabled /}
				{param avalaraEnabled: $avalaraEnabled /}
				{param customerServiceRepresentative: $customerServiceRepresentative /}
				{param numOfSections : length($cartSections) /}
				{param isLastSection : isLast($section) /}
				{param containsWineSection : $containsWineSection /}
			{/call}
		{/foreach}
	</div>
	{call .total}
		{param cartlineType: 'YOUR_CART' /}
		{param subTotalBox: $subTotalBox /}
		{param additionalInfo: $additionalInfo /}
		{param goGreen: $goGreen /}
		{param userRecognized: $userRecognized /}
		{param userCorporate: $userCorporate /}
		{param promotionApplied: $promotionApplied /}
		{param deliveryPassTrialExpired: $deliveryPassTrialExpired /}
		{param billingReferenceInfo: false /}
		{param eTippingEnabled: $eTippingEnabled /}
		{param avalaraEnabled: $avalaraEnabled /}
		{param customerServiceRepresentative: $customerServiceRepresentative /}
	{/call}
	{call .footer}
		{param buttonText: 'Checkout' /}
		{param form: 'viewcart_startcheckout' /}
		{param eTippingEnabled: $eTippingEnabled /}
		{param avalaraEnabled: $avalaraEnabled /} 
	{/call}
{/template}


/**
 * delivery fee tooltip
 */
{template .dfToolTip}
	{call .coreToolTip}
		{param ttMaster2ndClass: 'dfTTmaster' /}
		{param iconId: 'deliveryFeeToolTip' /}
		{param ttIcon2ndClass: 'deliveryFeeToolTipIcon' /}
		{param ttBox2ndClass: 'deliveryFeeToolTip' /}
		{param ttTitle: 'Delivery Fee' /}
		{param ttBody}
			<p>The delivery fee is not a gratuity
			for any FreshDirect employee who
			delivers or is otherwise involved
			with the delivery of your order
			and will not be given to any such
			employee as a gratuity.</p>
		{/param}
	{/call}
{/template}

/**
 * delivery fee tooltip
 */
{template .optToolTip}
	{call .coreToolTip}
		{param ttMaster2ndClass: 'optionalTTmaster' /}
		{param iconId: 'optionalToolTip' /}
		{param ttBox2ndClass: 'optionalTipToolTip' /}
		{param ttTitle: 'Optional Tip' /}
		{param ttBody}
			<p>Good news! Now you can e-tip as you're checking out.
			As a heads up, adding and updating e-tips is only available on our website for now,
			but we're working on adding it to our apps (stay tuned!). </p>
			
			<p>
			You are under no obligation to tip but have the option of providing a tip if you feel that you've received exceptional service.
			FreshDirect personnel are not permitted to solicit tips under any circumstances.
			The full amount of the tip, less the processing fee charged by the credit card processor,
			will be paid to the delivery personnel who participated in the actual delivery of your order as determined under our policies.
			Another option is to provide a cash tip at the time your order is delivered.
			</p>
		{/param}
	{/call}
{/template}

/**
 * tooltip core
 * @param? ttMaster2ndClass ttMaster2ndClass
 * @param iconId iconId
 * @param? ttIcon2ndClass ttIcon2ndClass
 * @param ttTitle ttTitle
 * @param? ttBody ttBody
 * @param ttBox2ndClass ttBox2ndClass
 */
{template .coreToolTip autoescape="strict" kind="html"}
	<div class="tooltip_holder {if $ttMaster2ndClass}{$ttMaster2ndClass}{/if}" tabindex="0" aria-describedby="tt_{$iconId}">
		<div class="ttBox1stClass {$ttBox2ndClass}" data-component="tooltipContent" id="tt_{$iconId}" role="tooltip">
			<div class="tooltip-inner">
				<b>{$ttTitle}</b>
				<br/>
				<span class="js_unescape">{$ttBody}</span>
			</div>
		</div>
		/*<a href="#" id="{$iconId}" data-component="tooltip" class="tooltip-small {if $ttIcon2ndClass}{$ttIcon2ndClass}{/if}">i</a>*/
		<span id="{$iconId}" class="tooltip-small {if $ttIcon2ndClass}{$ttIcon2ndClass}{/if}">i</span>
	</div>
{/template}

/**
 * @param subTotalBox subtotal
 * @param subTotal
 * @param cartSections List of cart sections
 * @param? additionalInfo Promotion info
 * @param? goGreen go green state
 * @param? userRecognized is the user recognized?
 * @param? userCorporate
 * @param? billingReferenceInfo billing reference info
 * @param? deliveryPassTrialExpired
 * @param? promotionApplied
 * @param etipTotal etipTotal
 * @param? tipAmounts
 * @param? tipApplied
 * @param? tipAppliedTick
 * @param customTip customTip
 * @param eTippingEnabled eTippingEnabled
 * @param avalaraEnabled avalaraEnabled
 * @param? customerServiceRepresentative
 * @param containsWineSection containsWineSection
 */
{template .checkoutlines autoescape="false"}
	<div class='cartcontent'>
		{foreach $section in $cartSections}
			{call .cartsection data="$section"}
				{param cartlineType: 'CHECKOUT' /}
				{param tipAmounts: $tipAmounts /}
				{param tipApplied: $tipApplied /}
				{param tipAppliedTick: $tipAppliedTick /}
				{param subTotalBox: $subTotalBox /}
				{param subTotal: $subTotal /}
				{param userRecognized: $userRecognized /}
				{param userCorporate: $userCorporate /}
				{param etipTotal: $etipTotal /}
				{param customTip: $customTip /}
				{param eTippingEnabled: $eTippingEnabled /}
				{param avalaraEnabled: $avalaraEnabled /}
				{param customerServiceRepresentative: $customerServiceRepresentative /}
				{param numOfSections : length($cartSections) /}
				{param isLastSection : isLast($section) /}
				{param containsWineSection : $containsWineSection /}
			{/call}
		{/foreach}
	</div>
	{call .total}
		{param cartlineType: 'CHECKOUT' /}
		{param subTotalBox: $subTotalBox /}
		{param additionalInfo: $additionalInfo /}
		{param goGreen: $goGreen /}
		{param userRecognized: $userRecognized /}
		{param billingReferenceInfo: $billingReferenceInfo /}
		{param promotionApplied: $promotionApplied /}
		{param deliveryPassTrialExpired: $deliveryPassTrialExpired /}
		{param eTippingEnabled: $eTippingEnabled /}
		{param avalaraEnabled: $avalaraEnabled /}
		{param customerServiceRepresentative: $customerServiceRepresentative /}
	{/call}
	{call .footer}
		{param buttonText: 'Place Order' /}
		{param form: 'checkout' /}
		{param eTippingEnabled: $eTippingEnabled /}
		{param avalaraEnabled: $avalaraEnabled /}
	{/call}
{/template}

/**
 * @param cartSections List of cart sections
 * @param? tipAmounts
 * @param? tipApplied
 * @param? tipAppliedTick
 * @param subTotalBox subtotal
 * @param subTotal
 * @param? userRecognized is the user recognized?
 * @param? userCorporate
 * @param etipTotal etipTotal
 * @param customTip customTip
 * @param eTippingEnabled eTippingEnabled
 * @param avalaraEnabled avalaraEnabled
 * @param containsWineSection containsWineSection
 */
{template .successlines autoescape="false"}
	<div class='cartcontent'>
		{foreach $section in $cartSections}
			{call .cartsection data="$section"}
				{param noModifyLinks: true /}
				{param cartlineType: 'CHECKOUT_SUCCESS' /}
				{param etipTotal: $etipTotal /}
				{param tipAmounts: $tipAmounts /}
				{param tipApplied: $tipApplied /}
				{param tipAppliedTick: $tipAppliedTick /}
				{param subTotalBox: $subTotalBox /}
				{param subTotal: $subTotal /}
				{param userRecognized: $userRecognized /}
				{param userCorporate: $userCorporate /}
				{param customTip: $customTip /}
				{param eTippingEnabled: $eTippingEnabled /}
				{param avalaraEnabled: $avalaraEnabled /}
				{param numOfSections : length($cartSections) /}
				{param isLastSection : isLast($section) /}
				{param containsWineSection : $containsWineSection /}
			{/call}
		{/foreach}
	</div>
	{call .footer}
		{param avalaraEnabled: $avalaraEnabled /}
		{param eTippingEnabled: $eTippingEnabled /}
	{/call}
{/template}

/**
 * @param? estimatedTotal Estimated total
 * @param? deliveryCharge Formatted price value
 * @param? cartChangedByCleanUp Boolean flag
 */
{template .cartheader autoescape="false"}
	<div class='cartheader'>
		<div class='cartheader__text'>
			<h1 class='cartheader__title'>Your Cart</h1>
			<p class='cartheader__sub'>Please review your cart before checking out.</p>
		</div>
		<div class='cartheader__subtotal'>
			<div class='charges'>
				{if $deliveryCharge}
					<div class="charges__row">
						<div class="charges__rowcell charges-text">Delivery Charge:</div>
						<div class="charges__rowcell charges-price" id="div_deliveryCharge">{$deliveryCharge}</div>
					</div>
				{/if}
				{if $estimatedTotal}
					<div class="charges__row">
						<div class="charges__rowcell charges-text">Estimated Total:</div>
						<div class="charges__rowcell charges-price" id="div_estimatedTotal">{$estimatedTotal}</div>
					</div>
				{/if}
			</div>
		</div>
		<div class='cartheader__action'>
			<form fdform="viewcart_startcheckout" action="#" fdform-disable-resubmit="true" fdform-disable-resubmit-selector=".cssbutton.orange" fdform-disable-resubmit-release="manual">
				<button class="cssbutton orange cartheader__button icon-chevron-right-after" fd-login-required>Checkout</button>
			</form>
		</div>
	</div>
	{if $cartChangedByCleanUp}
		<div class="warningBox">
			<div>We're sorry; some items you requested are no longer available for delivery,</div>
			<div>and have been removed from your cart.</div>
		</div>
	{/if}
{/template}

/**
 * @param? productSamplesTab sample products
 */
{template .productSampleCarouselWrapper}
	{if $productSamplesTab}
		<div fd-toggle="product-sample-carousel" fd-toggle-state="{if $productSamplesTab.productSamplesReacedMaximumItemQuantity}disabled{else}enabled{/if}">
			{call expressco.productSampleCarousel data="$productSamplesTab" /}
		</div>
	{/if}
{/template}

/**
*/
{template .cartheaderQuestions}
	<div class='cartheader__questions'>
		<div class='questions__left'>
			<strong>Questions?</strong> <a href='/help/index.jsp' class='questions__link'>Get help online</a> or call 1-212-796-8002
		</div>
		<div class='questions__right'>
			<label for="dontupdatecartlines">
				<input id="dontupdatecartlines" type="checkbox" name="dontupdatecartlines" value="true"/>
				<span>Don't update cartlines automatically</span>
			</label>
			<button class="cssbutton transparent green icon-reorder-icon-before" data-component="update-cart">Update cart</button>
			<button role="alertdialog" class='questions__empty cssbutton transparent white' data-component='emptycart'>
				<img src="/media_stat/images/icon-trash.png" alt="" class='questions__emptycart-image' />Empty Cart
			</button>
		</div>
	</div>
{/template}

/**
 * @param title title of section
 * @param cartLines List of cartline items
 * @param info Cartsection additional info
 * @param cartlineType Cartsection type: wine or fallback
 * @param populateDCPDPromoDiscount
 * @param etipTotal etipTotal
 * @param tipAmounts
 * @param tipApplied
 * @param tipAppliedTick
 * @param? userRecognized is the user recognized?
 * @param? userCorporate
 * @param subTotalBox subtotal
 * @param subTotal
 * @param customTip customTip
 * @param eTippingEnabled eTippingEnabled
 * @param avalaraEnabled avalaraEnabled
 * @param customerServiceRepresentative
 * @param numOfSections
 * @param isLastSection
 * @param containsWineSection containsWineSection
 */
{template .cartsection autoescape="false"}
	/* HACK OVERRIDE (yes, there are a lot of those lately) for when this is the success page */
	{let $cartlineTypeRevised: ($cartlineType == 'CHECKOUT_SUCCESS')? 'CHECKOUT' : $cartlineType /}

	<div class='cartsection {if $info.wine}cartsection-wine{/if} {if $eTippingEnabled and $cartlineType == 'CHECKOUT' }eTippingEnabled{/if}' {if $info.recipe}data-recipe-section="{$title}"{/if}>
		<h2 class='cartsection__title'>
			{if $info.recipe}
				Recipe: <span class="cartsection__title-noweight">{$title}</span>
			{else}
				{$title}
			{/if}
			{if $info.recipe and $cartlineType == 'YOUR_CART'}
				<span data-component="removeRecipeButton">
					<img src="/media_stat/images/icon-trash.png" alt="" class='cartline-delete-image' />Delete all recipe ingredients
				</span>
			{/if}
		</h2>

		
		{foreach $cartline in $cartLines}
			{delcall expressco.cartline data="$cartline" variant="$cartlineTypeRevised"}
				{param populateDCPDPromoDiscount: $populateDCPDPromoDiscount /}
				{param customerServiceRepresentative: $customerServiceRepresentative /}
				{param avalaraEnabled: $avalaraEnabled /}
			{/delcall}
		{/foreach}

		{if $info.subTotal}
			<div class='cartsection__totalwrapper'>
				{if $eTippingEnabled and $cartlineType == 'CHECKOUT' }
					{if $numOfSections > 1 and $containsWineSection}
						<p class='cartsection__total'>
							{if $info.subTotalText}{$info.subTotalText}{else}Subtotal{/if}: {$info.subTotal} {if $info.hasEstimatedPrice}*{/if}
						</p>
						<p class='cartsection__tax'>Tax: {$info.taxTotal}</p>
					{/if}

					{if $isLastSection or $numOfSections == 1}   		      
						<div id="subtotalbox1" class="subtotalboxes">
							{if $subTotalBox and $subTotalBox.subTotalBox}
								{call .subTotalBox}
									{param cartlineType: $cartlineType /}
									{param subTotalBox: $subTotalBox.subTotalBox /}
									{param userRecognized: $userRecognized /}
									{param userCorporate: $userCorporate /}
									{param eTippingEnabled: $eTippingEnabled /}
									{param avalaraEnabled: $avalaraEnabled /}
								{/call}
							{/if}
						</div>
						<div class='cartsection__tax' fdform-container="etip">
							<form fdform="etip" action="#" fdform-endpoint-submit="/api/expresscheckout/etip">  			
								<input type="hidden" name="hiddenSubTotal" id="hiddenSubTotal" value="{$subTotal}" />

								<div class="subtotal__rowcell-left" id="optionaltip">
									<span class="strl_text">Optional Tip</span>
									{call .optToolTip /}
									
								</div>
								
								<label for="tipDropdown">
									<span class="offscreen">Optional Tip:</span>
									
									<select id="tipDropdown" name="tipAmount" data-component="changeETip" {if $customTip}style="display:none" aria-hidden="true"{/if}>
									{foreach $option in $tipAmounts}
										<option value="{$option}" {if ($customTip and $option == 'Other Amount') or ($etipTotal == $option)}selected{/if}>{$option}</option>			  
									{/foreach}  
									</select>
								</label>
								
								<label for="tipTextBox">
									<span class="offscreen">Other Tip Amount:</span>
									
									<input type="text" id="tipTextBox" placeholder="0.00" name="otherTipAmount"
									{if not $customTip}style="display:none"{/if}
									{if $etipTotal and $customTip}value="{$etipTotal}"{/if} data-component="tooltip"/>
									
									<div id="toolTipTextBox" class="tooltip" data-component="tooltipContent" role="tooltip"></div>
								</label>
								
								{if $tipAppliedTick}
									<img id="tipAppliedTick" src="/media/layout/nav/globalnav/fdx/locabar-check.png" alt="Image of Tick" />
								{/if}
								<br/>
								<input type="hidden" name="action" value="applyETip" />
								{if $tipApplied}
									<button id="tipApplied" class="cssbutton grey" disabled>Tip Added</button>
									<button id="tipApply" style="display:none" aria-hidden="true" class="cssbutton green">Add Tip</button>
								{else}
									<button id="tipApply" class="cssbutton green">Add Tip</button>
									<button id="tipApplied" style="display:none" aria-hidden="true" class="cssbutton grey" disabled>Tip Added</button>
								{/if}
							</form>                
						</div><!--end div.cartsection__tax fdform-container="etip" -->
					 {/if}  /*end {if $isLastSection or $numOfSections == 1}  */
				{else}
					{if $eTippingEnabled and $cartlineType == 'CHECKOUT'}<div class="orderSummary">{/if}
					<p class='cartsection__total'>
						<span class="strl_text">
						{if $info.subTotalText}
							{$info.subTotalText}
						{else}
							Subtotal
						{/if}</span> <span class="subtotal__rowcell-mid">{$info.subTotal} {if $info.hasEstimatedPrice}*</span>{/if}
					</p>
						
					{if $eTippingEnabled and $cartlineType == 'CHECKOUT'}
						<div class="subtotal__rowcell-left" id="optionaltip">
						 	<p class='cartsection__total'>
						 		
						 		<span class="strl_text">Optional Tip</span> <span class="subtotal__rowcell-mid">{$etipTotal}</span>
						 		{call .optToolTip /}
						 	</p>
					 	</div>
					{/if}

					{if $avalaraEnabled}
						{if $cartlineType == 'CHECKOUT'}
							<p class='cartsection__tax'><span class="strl_text">Tax</span> <span class="subtotal__rowcell-mid">{$info.taxTotal}</span></p>
						{/if}
					{else}
						<p class='cartsection__tax'><span class="strl_text">Tax</span> <span class="subtotal__rowcell-mid">{$info.taxTotal}</span></p>
					{/if}
						
					{if $eTippingEnabled and $cartlineType == 'CHECKOUT'}
							<div class="SSorderTotal">
								{foreach $box in $subTotalBox.estimatedTotalBox}
									<span class="strl_text">{$box.text}</span> <span class="subtotal__rowcell-mid">{$box.value}</span>
								{/foreach}
							</div>
						</div><!--end div.orderSummary-->
					{/if}
				{/if} /*end if/else $eTippingEnabled */
			</div>
		{/if}
	</div><!--end div.cartsection.cartsection-wine?-->
{/template}

/**
 * @param id Unique id of cartline item
 * @param descr Cartline item name
 * @param confDescr Additional info for cartline item beside name
 * @param price Cartline price
 * @param qu Map of quantity descriptors
 * @param su List of salesunit options
 * @param image Location of cartline image
 * @param? newItem new item in modified order
 * @param? unitPrice Location of cartline image
 * @param? unitScale Location of cartline image
 * @param? discount Map of discount data
 * @param? coupon Map data of coupon
 * @param? couponDisplay Boolean
 * @param? couponClipped Boolean
 * @param? couponStatusText the html formatted coupon status message
 * @param? hasEstimatedPrice Boolean
 * @param? hasTax Boolean
 * @param? hasDepositValue Boolean
 * @param? hasScaledPricing Boolean
 * @param? freeSamplePromoProduct Boolean free sample product
 * @param? populateDCPDPromoDiscount
 * @param? mealBundle
 * @param? productId
 * @param? categoryId
 * @param? customerServiceRepresentative
 * @param? complaintReason masquerade mode make good order reason text
 * @param avalaraEnabled avalaraEnabled
 */
{deltemplate expressco.cartline autoescape="false" variant="'YOUR_CART'"}
	<div class='cartsection__cartline' data-component='cartline' data-cartlineid='{$id}'>
		<div class='cartline-imageholder cartline-box'>
			<a class='cartline-link' href='/product_modify.jsp?cartLine={$id}&trk=cart'>
				<img class='cartline-image' src='{if $image}{$image}{else}/media/images/fd_defs/meat/bstk_prtrhs_c.jpg{/if}' alt="Image of {$descr}" />
			</a>
		</div>
		<div class='cartline-title cartline-box'>
			<div class='cartline-titleholder'>
				<a class='cartline-link' href='{if $mealBundle}/pdp.jsp?productId={$productId}&catId={$categoryId}&modify=true{else}/product_modify.jsp?cartLine={$id}&trk=cart{/if}'>{$descr}</a>
				{if $newItem}
					<span class="new">(new)</span>
				{/if}
				{if $confDescr}
					<p class='cartline-descriptor'>({$confDescr})</a>
				{/if}
				{if $freeSamplePromoProduct}
					<p class='cartline-discount'><span class="red">Free Sample</span></p>
				{else}
					{if $discount and $discount.discountPrice}
						{if $discount.description}
							<p class='cartline-discount'>
								{$discount.description} <span class="red">(You Saved {$discount.discountPrice}{if $discount.skuLimit} on {$discount.skuLimit} item{if $discount.skuLimit>1}s{/if}{/if})</span>
							</p>
						{else}
							<p class='cartline-discount'><strong>Group Discount</strong> <span class="red">(You Saved {$discount.discountPrice})</span></p>
						{/if}
					{/if}
				{/if} /*end {if/else $freeSamplePromoProduct} */
				
				{if $coupon and not $freeSamplePromoProduct}
					<div class="cartline-coupon {if not $couponClipped}triangle-red triangle-right{/if}">
						{call common.ecoupon}
							{param coupon:$coupon /}
							{param couponDisplay:$couponDisplay /}
							{param couponClipped:$couponClipped /}
							{param couponStatusText:$couponStatusText /}
							{param detailsFirst:true /}
						{/call}
					</div>
				{/if} /*end if $coupon and not $freeSamplePromoProduct */
				
				{if isNonnull($populateDCPDPromoDiscount[$id])}<br><div class="promoMessage">{$populateDCPDPromoDiscount[$id]}</div>{/if}
				
				{if $customerServiceRepresentative and $customerServiceRepresentative.complaintReasons}
					<label class="cartline-complaint-reason-select">
						Make Good reason:
						<select data-component="complaintreason">
							<option value="nil" {if not $complaintReason}selected{/if}>- Choose reason -</option>
							{foreach $option in $customerServiceRepresentative.complaintReasons}
								<option value="{$option.id}" {if $complaintReason and $complaintReason.id == $option.id}selected{/if}>{$option.reason}</option>
							{/foreach}
						</select>
					</label>
				{/if}/*end if $customerServiceRepresentative and $customerServiceRepresentative.complaintReasons */
			</div>
		</div>
		<div class='cartline-delete cartline-box'>
			<a class='cartline-link' href='/expressco/view_cart.jsp?remove=1&cartLine={$id}'>
				<img src="/media_stat/images/icon-trash.png" alt="" class='cartline-delete-image' />Delete<span class="offscreen"> {$descr}</span>
			</a>
		</div>
		<div class='cartline-quantity cartline-box'>
			{if $freeSamplePromoProduct}
				{if $su}
					{foreach $option in $su}
						{if $option.selected}<span class="free-sample-quantity">{$option.name}</span>{/if}
					{/foreach}
				{elseif $qu}
					<span class="free-sample-quantity">{$qu.quantity}</span>
				{/if}
			{else}
				{if $qu}
					<form action="#" fdform="cartline_change_{$id}" fdform-submit="FreshDirect.modules.common.forms.submitFns.defaultButton">
						{call common.quantitybox}{param quantity:$qu /}{param uid: 'cartline_change_'+$id /}{/call}
					</form>
				{/if}
				{if $su}{call common.salesunit}{param options:$su /}{/call}{/if}
			{/if}
		</div>
		<div class='cartline-price cartline-box'>
			<div class='cartline-pricewrapper'>
				{if $freeSamplePromoProduct}
					<p class='cartline-price-value product-sample-free'>FREE</p>
				{else}
					<p class='cartline-price-value'>{$price}</p>
					{if $unitPrice}<p class='cartline-unitprice'>({$unitPrice}/{$unitScale})</p>{/if}
				{/if}
			</div>
		</div>
		<div class="cartline-legend cartline-box">
			<div class="cartline-legendwrapper">
				{if $hasEstimatedPrice and not $avalaraEnabled}<div class="legend-item">*</div>{/if}
				{if $hasTax and not $avalaraEnabled}<div class="legend-item">T</div>{/if}
				{if $hasDepositValue and not $avalaraEnabled}<div class="legend-item">D</div>{/if}
				{if $hasScaledPricing and not $avalaraEnabled}<div class="legend-item">S</div>{/if}
			</div>
		</div>
	</div>
{/deltemplate}

/**
 * @param id Unique id of cartline item
 * @param descr Cartline item name
 * @param confDescr Additional info for cartline item beside name
 * @param price Cartline price
 * @param qu Map of quantity descriptors
 * @param su List of salesunit options
 * @param image Location of cartline image
 * @param? newItem new item in modified order
 * @param? unitPrice Location of cartline image
 * @param? unitScale Location of cartline image
 * @param? discount Map of discount data
 * @param? coupon Map data of coupon
 * @param? couponDisplay Boolean
 * @param? couponClipped Boolean
 * @param? couponStatusText the html formatted coupon status message
 * @param? noModifyLinks hide product modify links
 * @param? hasEstimatedPrice Boolean
 * @param? hasTax Boolean
 * @param? hasDepositValue Boolean
 * @param? hasScaledPricing Boolean
 * @param? freeSamplePromoProduct Boolean free sample product
 * @param? complaintReason masquerade mode make good order reason text
 */
{deltemplate expressco.cartline autoescape="false" variant="'CHECKOUT'"}
	<div class='cartsection__cartline' data-component='cartline' data-cartlineid='{$id}'>
		<div class='cartline-imageholder cartline-box'>
			{if $noModifyLinks}
				<img class='cartline-image' src='{if $image}{$image}{else}/media/images/fd_defs/meat/bstk_prtrhs_c.jpg{/if}' alt="Image of {$descr}" />
			{else}
				<a class='cartline-link' href='/product_modify.jsp?cartLine={$id}&trk=cart'>
					<img class='cartline-image' src='{if $image}{$image}{else}/media/images/fd_defs/meat/bstk_prtrhs_c.jpg{/if}' alt="Image of {$descr}" />
				</a>
			{/if}
		</div>
		<div class='cartline-title cartline-box'>
			<div class='cartline-titleholder'>
				{if $noModifyLinks}
					{$descr}
				{else}
					<a class='cartline-link' href='/product_modify.jsp?cartLine={$id}&trk=cart'>
						{$descr}
					</a>
				{/if}
				{if $newItem}
					<span class="new">(new)</span>
				{/if}
				
				{if $confDescr}<p class='cartline-descriptor'>({$confDescr})</a>{/if}
				
				{if $freeSamplePromoProduct}
					<p class='cartline-discount'><span class="red">Free Sample</span></p>
				{else}
					{if $discount and $discount.discountPrice}
						{if $discount.description}
							<p class='cartline-discount'>
								{$discount.description}
								<span class="red">
									(You Saved {$discount.discountPrice}{if $discount.skuLimit} on {$discount.skuLimit} item{if $discount.skuLimit>1}s{/if}{/if})
								</span>
							</p>
						{else}
							<p class='cartline-discount'>
								<strong>Group Discount</strong> <span class="red">(You Saved {$discount.discountPrice})</span>
							</p>
						{/if}
					{/if}
				{/if}
				{if $coupon and $couponClipped}
					<div class="cartline-coupon">
						{call common.ecoupon}
							{param coupon:$coupon /}
							{param couponDisplay:$couponDisplay /}
							{param couponClipped:$couponClipped /}
							{param couponStatusText:$couponStatusText /}
							{param detailsFirst:true /}
						{/call}
					</div>
				{/if}
				
				{if $complaintReason and $complaintReason.reason}
					<p class='cartline-complaint'>Make Good reason: {$complaintReason.reason}</p>
				{/if}
			</div>
		</div>
		<div class='cartline-delete cartline-box'></div>
		<div class='cartline-quantity cartline-quantity-bigger cartline-box'>
			{if $su}
				{foreach $option in $su}
					{if $option.selected}{$option.name}{/if}
				{/foreach}
			{elseif $qu}
				{$qu.quantity}
			{/if}
		</div>
		<div class='cartline-price cartline-box'>
			<div class='cartline-pricewrapper'>
				{if $freeSamplePromoProduct}
					<p class='cartline-price-value product-sample-free'>FREE</p>
				{else}
					<p class='cartline-price-value'>{$price}</p>
					{if $unitPrice}<p class='cartline-unitprice'>({$unitPrice}/{$unitScale})</p>{/if}
				{/if}
			</div>
		</div>
		<div class="cartline-legend cartline-box">
			<div class="cartline-legendwrapper">
				{if $hasEstimatedPrice}<div class="legend-item">*</div>{/if}
				{if $hasTax}<div class="legend-item">T</div>{/if}
				{if $hasDepositValue}<div class="legend-item">D</div>{/if}
				{if $hasScaledPricing}<div class="legend-item">S</div>{/if}
			</div>
		</div>
	</div>
{/deltemplate}

/**

 * @param cartlineType Cartsection type
 * @param subTotalBox subtotal
 * @param? additionalInfo Promotion info
 * @param? goGreen go green state
 * @param? userRecognized is the user recognized?
 * @param? userCorporate
 * @param? deliveryPassTrialExpired
 * @param? promotionApplied
 * @param? billingReferenceInfo billing reference
 * @param eTippingEnabled eTippingEnabled
 * @param avalaraEnabled avalaraEnabled
 * @param? customerServiceRepresentative Customer service representative data
 */
{template .total autoescape="false"}
<div class='total {if $eTippingEnabled and $cartlineType == 'CHECKOUT'}eTippingEnabled{/if}'>
	<div class='total-left'>
		<div class='total__promotion'>
			<div class='promotion-item' {if $promotionApplied}style="display: none;" aria-hidden="true"{/if} fdform-container="promotion" fdform-container-promotionremove>
				<form fdform="promotion" action="#" fdform-endpoint-submit="/api/expresscheckout/promotion" fdform-success="FreshDirect.modules.common.forms.successFns.hideOnSuccess">
					<p class='promotion-text'>Have a promotional code?</p>
					<div>
						<input type="text" class="promotion-input" name="promotionCode" placeholder="Enter here" />
						<input type="hidden" name="action" value="applyPromotion" />
						<button class="cssbutton green small">apply<span class="offscreen">promotion code</span></button>
					</div>
				</form>
			</div>
			{if $userRecognized}
				<div class='promotion-item' fdform-container="giftcard">
					<form fdform="giftcard" action="#" fdform-endpoint-submit="/api/expresscheckout/giftcard" fdform-success="FreshDirect.modules.common.forms.successFns.reset">
						<p class='promotion-text'>Have a new Gift Card?</p>
						<div>
							<input type="text" class="promotion-input" name="givexNum" placeholder="Enter here" />
							<input type="hidden" name="action" value="applyGiftCard" />
							<button class="cssbutton green small">apply<span class="offscreen">new gift card</span></button>
						</div>
					</form>
				</div>
			{/if} /*end if $userRecognized */
			<span id="billingReferenceInfoContainer">
				{if $billingReferenceInfo}
					{call .billingReferenceInfo data="$billingReferenceInfo" /}
				{/if}
			</span>
		</div> <!-- end div.total__promotion -->
		{if $userRecognized and $deliveryPassTrialExpired}
			<div class='total__deliverypass'>
				<div class='deliverypass-wrapper'>
					<div class='deliverypass-left'>
						<p class='deliverypass-expire'>Your DeliveryPass&#8482; trial has expired.</p>
						<p class='deliverypass-sub'>Upgrade your delivery options.</p>
					</div>
					<div class='deliverypass-right'>
						<a href='#' data-component='deliverypasspopup' class='deliverypass-upgrade'>Upgrade Now</a>
					</div>
				</div>
			</div>
		{/if} /*end if $userRecognized and $deliveryPassTrialExpired */
		{if $userRecognized}
			<div class='total__gogreen'>
				<form fdform="gogreen" action="#">
					<p class="gogreen-text">
						<label for="gogreen">
							<input id="gogreen" fdform-button="submitgogreen" fdform-prevent="manual" name="goGreen" type="checkbox" value="Y" {if $goGreen}checked{/if} />
							<strong>Go Green. Go Paperless.</strong> Get email receipts and save a tree.
						</label>
					</p>
				</form>
			</div>
			{if $customerServiceRepresentative}
				<div class="total-masq">
					<form fdform="csrfield" fdform-endpoint-submit="/api/expresscheckout/csr" action="#">
						{if $customerServiceRepresentative.deliveryCharge > 0}
							<p><label for="deliveryForceWaived">
								Delivery Fee: Force Waive
								<input id="deliveryForceWaived" type="checkbox" name="dlvForceWaive" {if $customerServiceRepresentative.deliveryForceWaived}checked{/if}>
							</label></p>
						{/if} /*end if $customerServiceRepresentative.deliveryCharge > 0 */
						
						{if $customerServiceRepresentative.deliveryChargePremium > 0}
							<p><label for="deliveryForceWaivedPremium">
								Delivery Fee: Force Waive Premium
								<input id="deliveryForceWaivedPremium" type="checkbox" name="dlvForceWaivePremium" {if $customerServiceRepresentative.isPremiumDeliveryForceWaived}checked{/if}>
							</label></p>
						{/if}
						
						{if $customerServiceRepresentative.phoneCharge > 0}
							<p><label for="phoneHandlingChargeWaived">
								Waive Phone Handling Charge (${$customerServiceRepresentative.phoneCharge})
								<input id="phoneHandlingChargeWaived" type="checkbox" name="waivePhoneHandlingCharge" {if $customerServiceRepresentative.phoneHandlingChargeWaived}checked{/if}>
							</label></p>
						{/if}
						
						<p><label for="emailInvoiceSendingSkipped">
							Don't send e-mail invoice
							<input id="emailInvoiceSendingSkipped" type="checkbox" name="silentMode" {if $customerServiceRepresentative.emailInvoiceSendingSkipped}checked{/if}>
						</label></p>
						<p><label for="customerInvoiceMessage">
							Customer Invoice Message
							<input id="customerInvoiceMessage" class="masq-input" type="text" name="customerInvoiceMessage" {if $customerServiceRepresentative.customerInvoiceMessage}value="{$customerServiceRepresentative.customerInvoiceMessage}"{/if}>
						</label></p>
						<p><button class="cssbutton green" fdform-button="submit">apply</button></p>
					</form>
				</div>
			{/if} /* end if $customerServiceRepresentative */
	    {/if} /* end if $userRecognized */
		</div>
		<div class='total__subtotal total-right'>
			<div id="subtotalbox2" class="subtotalboxes">
				{if $eTippingEnabled and $cartlineType == 'CHECKOUT' }	
					{if $subTotalBox and $subTotalBox.estimatedTotalBox}
						{call .subTotalBox}
							{param cartlineType: $cartlineType /}
							{param subTotalBox: $subTotalBox.estimatedTotalBox /}
							{param userRecognized: $userRecognized /}
							{param userCorporate: $userCorporate /}
							{param eTippingEnabled: $eTippingEnabled /}
							{param avalaraEnabled: $avalaraEnabled /}
						{/call}
					{/if}
				{else}
					{if $subTotalBox and $subTotalBox.subTotalBox}
						{call .subTotalBox}
							{param cartlineType: $cartlineType /}
							{param subTotalBox: $subTotalBox.subTotalBox /}
							{param userRecognized: $userRecognized /}
							{param userCorporate: $userCorporate /}
							{param eTippingEnabled: $eTippingEnabled /}
							{param avalaraEnabled: $avalaraEnabled /}
						{/call}
					{/if}
				{/if}
			</div>
			{call .additionalInfo}
				{param additionalInfo: $additionalInfo /}
			{/call}
		</div>
	</div>
{/template}

/**
 * @param corporateUser
 * @param billingReference
 */
{template .billingReferenceInfo}
	{if $corporateUser}
		<div class='promotion-item'>
			<form fdform="checkout" action="#">
				<p class='promotion-text'>Billing reference/Client code</p>
				<div>
					<input type="text" class="promotion-input" name="billingReference" value="{$billingReference ? $billingReference : ''}" placeholder="Enter here" />
				</div>
			</form>
		</div>
	{/if}
{/template}

/**
* @param? estimatedTotal
*/
{template .checkoutButton}
	<button class="cssbutton orange checkout_button_w_subtotal icon-chevron-right-after">
		<span>Place Order</span>
		{if $estimatedTotal}<span class="est_total">Est. Total: {$estimatedTotal}</span>{/if}
	</button>
{/template}

/**
* @param? cartlineType cartlineType
* @param? subTotalBox subTotalBox data
* @param? userRecognized is the user recognised or not
* @param? userCorporate COS service is available for customer
* @param? avalaraEnabled avalaraEnabled
* @param? eTippingEnabled eTippingEnabled
*/
{template .subTotalBox}
	{let $subtotalUsed: 0 /}
	{let $deliveryUsed: 0 /}
	{let $orderTotalUsed: 0 /}

	{if $subTotalBox}					
		{foreach $box in $subTotalBox}
		  {if $avalaraEnabled and ($box.text == 'Sales Tax' or $box.text == 'Total Tax') and $cartlineType == 'YOUR_CART'}/*condition not to show tax on view cart */
	  			
		  {else}	
			<div class='subtotal__row {if $box.id == 'youSaved'}row-style-saving{/if} {if $box.id == 'ssOrderTotal'}row-size-big{/if}' data-boxid='{$box.id}'>
				<div class='subtotal__rowcell-left rowcell-colon-right st_label st_label_{$box.id}' id='st_label_{$box.id}'>
					{if $box.id == 'freefood'}
						<a href='/shared/promotion_popup.jsp?promoCode=signup'
						data-ifrpopup='/shared/promotion_popup.jsp?promoCode=signup'
						data-ifrpopup-width='585' data-ifrpopup-height='400' class="strl_text">
							{$box.text}
						</a>
					{else}
						{if $box.other and $box.other.promoCode}
							<a href='/shared/promotion_popup.jsp?promoCode={$box.other.promoCode}'
							data-ifrpopup='/shared/promotion_popup.jsp?promoCode={$box.other.promoCode}'
							data-ifrpopup-width='375' data-ifrpopup-height='335'>
								{$box.text}
							</a>
						{else}
							{if $box.id == 'deliveryfee' and ($deliveryUsed == 0) and not $box.other.deliveryPassPopupNeeded }
								<span class="strl_text">{$box.text}</span>
								{if $eTippingEnabled and $cartlineType == 'CHECKOUT'}
									{call .dfToolTip /}
								{/if}
								
								{let $deliveryUsed: 1 /}
							{else}
								{if $box.id == 'ssOrderTotal'}
									<span class="strl_text ssOrderTotal">{$box.text}</span>
								{else}
									<span class="strl_text">{$box.text}</span>
									{if $box.id == 'deliveryfee' and $eTippingEnabled}
										{call .dfToolTip /}
									{/if}
								{/if}
							{/if} /*end if $box.id == 'deliveryfee' and not $box.other.deliveryPassPopupNeeded */
						{/if} /*end if $box.other and $box.other.promoCode */
					{/if} /*end if $box.id == 'freefood' */
				</div><!--end div.subtotal__rowcell-left.rowcell-colon-right -->

				<div class='subtotal__rowcell-mid rowcell-text-right st_val st_val_{$box.id}'>
					{if $box.id == 'deliveryfee' and ($deliveryUsed == 0) and not $box.other.deliveryPassPopupNeeded}
						{if $eTippingEnabled and $cartlineType == 'CHECKOUT'}
							{call .dfToolTip /}
						{/if}
						<div class="rowcontent-free-with-pass">
							{$box.value}
						</div>
						
						{let $deliveryUsed: 1 /}
					{else}		
							{$box.value}
					{/if}
				</div>
			
				{if $avalaraEnabled}
					{if $cartlineType == 'CHECKOUT'}
						<div class='subtotal__rowcell-left rowcell-colon-right st_label st_label_{$box.id}' id='st_label_{$box.id}'>
							{if $box.id == 'freefood'}
								<a href='/shared/promotion_popup.jsp?promoCode=signup'
								data-ifrpopup='/shared/promotion_popup.jsp?promoCode=signup'
								data-ifrpopup-width='585' data-ifrpopup-height='400'>
									{$box.text}
								</a>
							{else}
								{if $box.other and $box.other.promoCode}
									<a href='/shared/promotion_popup.jsp?promoCode={$box.other.promoCode}'
									data-ifrpopup='/shared/promotion_popup.jsp?promoCode={$box.other.promoCode}'
									data-ifrpopup-width='375' data-ifrpopup-height='335'>{$box.text}</a>
								{else}
									{if $box.id == 'deliveryfee' and ($deliveryUsed == 0) and not $box.other.deliveryPassPopupNeeded}
										{$box.text}
										{if $eTippingEnabled}
											{call .dfToolTip /}
										{/if} /*end if $eTippingEnabled */
										
										{let $deliveryUsed: 1 /}
									{else}
										{$box.text}
									{/if} /*end if/else $box.id == 'deliveryfee' and not $box.other.deliveryPassPopupNeeded */
								{/if} /*end if/else $box.other and $box.other.promoCode */
							{/if} /*end if/else $box.id == 'freefood' */
						</div>
						<div class='subtotal__rowcell-mid rowcell-text-right st_val st_val_{$box.id}' id='st_val_{$box.id}'>
							{if $box.id == 'deliveryfee' and $deliveryUsed == true and not $box.other.deliveryPassPopupNeeded}
								<div class="rowcontent-free-with-pass">{$box.value}</div>
								
								{let $deliveryUsed: 1 /}
							{else}
								{$box.value}
							{/if}
						</div>
					{/if} /*end if $cartlineType == 'CHECKOUT' */
				{/if}/*End condition not to show tax on view cart */
					{if $cartlineType == 'YOUR_CART'}
						{if $box.id != 'deliveryfee' and $box.id != 'ssOrderTotal'}
							<div class='subtotal__rowcell-left rowcell-colon-right st_label st_label_{$box.id}' id='st_label_{$box.id}'>
								{if $box.id == 'freefood'}
									<a href='/shared/promotion_popup.jsp?promoCode=signup'
									data-ifrpopup='/shared/promotion_popup.jsp?promoCode=signup'
									data-ifrpopup-width='585' data-ifrpopup-height='400'>
										{$box.text}
									</a>
								{else}
									{if $box.other and $box.other.promoCode}
										<a href='/shared/promotion_popup.jsp?promoCode={$box.other.promoCode}'
										data-ifrpopup='/shared/promotion_popup.jsp?promoCode={$box.other.promoCode}'
										data-ifrpopup-width='375' data-ifrpopup-height='335'>
											{$box.text}
										</a>
									{else}
										{if $box.id == 'deliveryfee' and ($deliveryUsed == 0) and not $box.other.deliveryPassPopupNeeded}
											{$box.text}
											{if $eTippingEnabled and $cartlineType == 'CHECKOUT'}
												{call .dfToolTip /}
											{/if}
											
											
											{let $deliveryUsed: 1 /}
										{else}
											{$box.text}
										{/if} /*end if/else $box.id == 'deliveryfee' and not $box.other.deliveryPassPopupNeeded */
									{/if} /*end if/else $box.other and $box.other.promoCoded */
								{/if} /*end if $box.id == 'freefood' */
							</div>
	
							<div class='subtotal__rowcell-mid rowcell-text-right st_val st_val_{$box.id}'>
								{if $box.id == 'deliveryfee' and ($deliveryUsed == 0) and not $box.other.deliveryPassPopupNeeded}
									<div class="rowcontent-free-with-pass">
										{$box.value}
									</div>
									
									{let $deliveryUsed: 1 /}
								{else}
									{$box.value}
								{/if}
							</div>
						{/if} /*end if/else $box.id != 'deliveryfee' */
					{/if} /*end if $box.id != 'deliveryfee' and $box.id != 'ssOrderTotal' */
				{/if} /*end if $cartlineType == 'YOUR_CART' */
				
				{if $box.other}
					<div class='subtotal__rowcell-right'>
						{if $box.other.mark}{$box.other.mark}{/if}
						{if $box.id == 'redemptionpromo'}
							<form fdform="promotionremove" action="#"
							fdform-endpoint-submit="/api/expresscheckout/promotion"
							fdform-success="FreshDirect.modules.common.forms.successFns.showOnSuccess">
								<input type="hidden" name="promotionCode" value="{$box.other.promoCode}" />
								<input type="hidden" name="action" value="removePromotion"/>
								<a href="#" fdform-button="submit" class="note">{$box.other.removeCode}</a>
							</form>
						{/if}
						{if $box.id == 'giftcardbalance'}
							<form fdform="giftcardbalanceremove" action="#" fdform-endpoint-submit="/api/expresscheckout/giftcard">
								<input type="hidden" name="action" value="removeGiftCard"/>
								<a href="#" fdform-button="submit" class="note">Remove</a>
							</form>
						{/if}
						{if $box.other.deliveryPassPopupNeeded and $userRecognized and $userCorporate == false}
							<span class="free-link-holder">&nbsp;or <a href="#" class="free-link" data-component="deliverypasspopup">Free</a></span>
						{/if}
					</div> <!-- end subtotal__rowcell-right -->
				{/if} /*end if $box.other */
			</div>
		{/foreach} /* end foreach $box in $subTotalBox */
	{/if} /*end if $subTotalBox */
{/template}

/**
* @param? additionalInfo List of additional messages
*/
{template .additionalInfo}
	{if $additionalInfo and length($additionalInfo) > 0}
		<div class='additionalinfo'>
			{foreach $info in $additionalInfo}
				<p data-info-id="{$info.id}">{$info.text}</p>
			{/foreach}
		</div>
	{/if}
{/template}

/**
 * @param? buttonText Display text of button
 * @param? navLink Where the button should navigate
 * @param? form form id for button
 * @param avalaraEnabled avalaraEnabled
 */
{template .footer autoescape="false"}
	<div class='footer'>
		{if $form}
			<div fdform-error-container="{$form}"></div>
		{/if}
		<div class='footer__left'>
			{if $avalaraEnabled}
				{if $buttonText == 'Place Order'}
					<p>
						<span class='footer__legend'>* - Estimated Price</span>
						<span class='footer__legend'>T - Taxable Item</span>
						<span class='footer__legend'>D - State Bottle Deposit</span>
						<span class='footer__legend'>S - Special Price</span>
					</p>
				{/if}
			{else}
				<p>
			
				</p>
			{/if} /*end if $avalaraEnabled */
			<p class='footer__findout'>
				Find out more about <a href='/help/estimated_price.jsp' data-ifrpopup='/help/estimated_price.jsp' data-ifrpopup-width='375' data-ifrpopup-height='335'>estimated prices</a>,
				<a href='/help/taxes_fees.jsp' data-ifrpopup='/help/taxes_fees.jsp' data-ifrpopup-width='375' data-ifrpopup-height='335'>taxes, deposits, and fees</a>,<br />
				and other aspects of our <a href='/help/terms_of_service.jsp' data-ifrpopup='/help/terms_of_service.jsp?type=popup' data-ifrpopup-width='600'>customer agreement</a>
			</p>
		</div>
		<div class='footer__right'>
			{if $form}<form fdform="{$form}" action="#">{/if}
			{if $navLink}<a href='{$navLink}'>{/if}
			{if $buttonText}<button class="cssbutton orange footer__button icon-chevron-right-after" fd-login-required>{$buttonText}</button>{/if}
			{if $navLink}</a>{/if}
			{if $form}</form>{/if}
		</div>
	</div> <!-- end div.footer -->
{/template}

/**
* @param? couponMessage
*/
{template .couponMessage autoescape="false"}
	{if $couponMessage}
		<div class="triangle-right triangle-red">
			<div class="cartcoupon-message">{$couponMessage}</div>
		</div>
	{/if}
{/template}
