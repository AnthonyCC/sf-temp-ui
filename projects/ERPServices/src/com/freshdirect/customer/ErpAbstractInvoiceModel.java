/* Generated by Together */

package com.freshdirect.customer;

/**
 * @stereotype ErpModel 
 */
import java.util.*;

import com.freshdirect.affiliate.ErpAffiliate;
import com.freshdirect.framework.util.MathUtil;

/**
 * @stereotype fd-model 
 */
public abstract class ErpAbstractInvoiceModel extends ErpTransactionModel {
    
    /**
     * @link aggregationByValue
     * @clientCardinality 1..*
     * @supplierCardinality 1..* 
     */
	private double tax;
	private double subtotal;
	private double amount;
	private List charges;
	private String invoiceNumber;

    /**
     * @associates <{ErpInvoiceLineModel}>
     * @link aggregationByValue
     */
    private List invoiceLines;

	public ErpAbstractInvoiceModel(EnumTransactionType transType) {
        super(transType);
        this.charges = new ArrayList();
    }

	public double getTax(){
		return this.tax;
	}
		
	public void setTax(double tax){
		this.tax = tax;
	}

	public double getDepositValue() {
		double deposit = 0.0;
		for (Iterator i=this.invoiceLines.iterator(); i.hasNext(); ) {
			ErpInvoiceLineModel invoiceLine = (ErpInvoiceLineModel) i.next();
			deposit += invoiceLine.getDepositValue();
		}
		return deposit;
	} 

	public double getSubTotal(){		
		return this.subtotal;
	}
	
	
	public double getActualSubTotal(){		
		double subTotal = 0.0;
		if(this.invoiceLines==null) return 0; 
		for (Iterator i = this.invoiceLines.iterator(); i.hasNext();) {
			ErpInvoiceLineModel invoiceLine = (ErpInvoiceLineModel)i.next();
			subTotal += MathUtil.roundDecimal(invoiceLine.getPrice()+invoiceLine.getActualDiscountAmount());
		}
		return MathUtil.roundDecimal(subTotal);		
	}
			

	public void setSubTotal(double subTotal){
		this.subtotal = subTotal;
	}

		

	public List getInvoiceLines(){
		return this.invoiceLines;
	}
	
	public ErpInvoiceLineModel getInvoiceLine(String lineNumber){
		ErpInvoiceLineModel foundInvoiceLine = null;
		for(Iterator i = this.invoiceLines.iterator(); i.hasNext(); ){
			ErpInvoiceLineModel invoiceLine = (ErpInvoiceLineModel)i.next();
			if(invoiceLine.getOrderLineNumber().equals(lineNumber)){
				foundInvoiceLine = invoiceLine;
				break;
			}
		}
		return foundInvoiceLine;
	}
			

	public void  setInvoiceLines(List lines){
		this.invoiceLines = lines;
	}

    public double getAmount() {
        return this.amount;
    }
	public void setAmount(double amount){
		this.amount = amount;
	}
	
	public double getPreTaxAmount(){
		return this.amount - this.tax;
	}
	
    public List getCharges() { 
    	return this.charges; 
    }
    public void setCharges(List charges) { 
    	this.charges = charges; 
    }
    public void addCharge(ErpChargeLineModel charge) { 
    	this.charges.add(charge); 
    }
    public void addCharges(List charges) { 
    	this.charges.addAll(charges); 
    }

	public ErpChargeLineModel getCharge(EnumChargeType chargeType) {
		ErpChargeLineModel charge = null;
        for (Iterator i=this.charges.iterator(); i.hasNext(); ) {
        	ErpChargeLineModel curr = (ErpChargeLineModel)i.next();
        	if (chargeType.equals( curr.getType() )) {
        		if (charge!=null) {
        			throw new RuntimeException("Multiple charges present of type "+chargeType);
        		}
        		charge = curr;
        	}
        }
        return charge;
	}

	public List getCharges(EnumChargeType chargeType) {
		List chargeList = new ArrayList();
        for (Iterator i=this.charges.iterator(); i.hasNext(); ) {
        	ErpChargeLineModel curr = (ErpChargeLineModel)i.next();
        	if (chargeType.equals( curr.getType() )) {
        		chargeList.add( curr );
        	}
        }
		return chargeList;
	}
 
	public double getDeliverySurcharge() {
		ErpChargeLineModel charge = getCharge(EnumChargeType.DELIVERY);
		return charge==null ? 0.0 : charge.getAmount();
	}
	
	public double getRestockingFee(ErpAffiliate affiliate){
		ErpChargeLineModel charge = null;
		
		if(ErpAffiliate.getEnum(ErpAffiliate.CODE_FD).equals(affiliate)){
			charge = this.getCharge(EnumChargeType.FD_RESTOCKING_FEE);
		}
		if(ErpAffiliate.getEnum(ErpAffiliate.CODE_WBL).equals(affiliate)){
			charge = this.getCharge(EnumChargeType.WBL_RESTOCKING_FEE);
		}
		if(ErpAffiliate.getEnum(ErpAffiliate.CODE_BC).equals(affiliate)){
			charge = this.getCharge(EnumChargeType.BC_RESTOCKING_FEE);
		}
		if(ErpAffiliate.getEnum(ErpAffiliate.CODE_USQ).equals(affiliate)){
			charge = this.getCharge(EnumChargeType.USQ_RESTOCKING_FEE);
		}

		return charge == null ? 0.0 : charge.getAmount();
	}
	
	public double getFDRestockingFee(){
		ErpChargeLineModel charge = this.getCharge(EnumChargeType.FD_RESTOCKING_FEE);
		return charge==null ? 0.0 : charge.getAmount();
	}
	
	public double getWBLRestockingFee(){
		ErpChargeLineModel charge = this.getCharge(EnumChargeType.WBL_RESTOCKING_FEE);
		return charge==null ? 0.0 : charge.getAmount();
	}
	
	public double getPhoneCharge(){
		ErpChargeLineModel charge = this.getCharge(EnumChargeType.PHONE);
		return charge==null ? 0.0 : charge.getAmount();
	}

    public String getInvoiceNumber(){
		return this.invoiceNumber;
	}

    public void setInvoiceNumber(String invoiceNum){
		this.invoiceNumber = invoiceNum;
	}
	
}
