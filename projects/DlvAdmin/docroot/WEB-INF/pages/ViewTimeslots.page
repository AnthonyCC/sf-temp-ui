<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE page-specification PUBLIC
  "-//Apache Software Foundation//Tapestry Specification 3.0//EN"
  "http://jakarta.apache.org/tapestry/dtd/Tapestry_3_0.dtd">
<!-- generated by Spindle, http://spindle.sourceforge.net -->


<page-specification class="com.freshdirect.dlvadmin.ViewTimeslots">

	<property-specification name="selectedRegion" type="com.freshdirect.delivery.model.DlvRegionModel" persistent="yes"/>
	<property-specification name="selectedZone" type="java.lang.String" persistent="yes"/>
	<property-specification name="selectedDay" type="java.lang.Integer" persistent="yes"/>

	<property-specification name="startDate" initial-value="calculateDate(-7)" type="java.util.Date"/>
	<property-specification name="endDate" initial-value="calculateDate(7)" type="java.util.Date"/>

	<property-specification name="currentZone" type="com.freshdirect.delivery.model.DlvZoneModel"/>
	<property-specification name="currentDay" type="java.util.Date"/>
	<property-specification name="currentTimeslot" type="com.freshdirect.delivery.model.DlvTimeslotModel"/>

    <component id="border" type="Border"/>

    <component id="datePickerEnd" type="DatePicker">
        <binding name="format" expression='"MM-dd-yy"'/>
        <binding name="value" expression='endDate'/>
    </component>

    <component id="datePickerStart" type="DatePicker">
        <binding name="format" expression='"MM-dd-yy"'/>
        <binding name="value" expression='startDate'/>
    </component>

    <component id="forEachDay" type="Foreach">
        <binding name="source" expression='getDays()'/>
        <binding name="value" expression='currentDay'/>
    </component>

    <component id="forEachTimeslot" type="Foreach">
        <binding name="source" expression='getTimeslots(currentZone.zoneCode,  currentDay)'/>
        <binding name="value" expression='currentTimeslot'/>
    </component>

    <component id="forEachZone" type="Foreach">
        <binding name="source" expression='getZones()'/>
        <binding name="value" expression='currentZone'/>
    </component>

    <component id="formFilter" type="Form">
        <binding name="stateful" expression='false'/>
    </component>

    <component id="formRegion" type="Form">
        <binding name="direct" expression='true'/>
        <binding name="stateful" expression='false'/>
    </component>

    <component id="ifRegionSelected" type="Conditional">
        <binding name="condition" expression='selectedRegion != null'/>
    </component>

    <component id="insertCapacityTotal" type="Insert">
        <binding name="value" expression='getCapacityTotal(currentZone.zoneCode, currentDay)'/>
    </component>

    <component id="insertAllocationTotal" type="Insert">
        <binding name="value" expression='getAllocationTotal(currentZone.zoneCode, currentDay)'/>
    </component>

    <component id="insertBaseCapacityTotal" type="Insert">
        <binding name="value" expression='getBaseCapacityTotal(currentZone.zoneCode, currentDay)'/>
    </component>

    <component id="insertBaseAllocationTotal" type="Insert">
        <binding name="value" expression='getBaseAllocationTotal(currentZone.zoneCode, currentDay)'/>
    </component>

    <component id="insertCTCapacityTotal" type="Insert">
        <binding name="value" expression='getCTCapacityTotal(currentZone.zoneCode, currentDay)'/>
    </component>

    <component id="insertCTAllocationTotal" type="Insert">
        <binding name="value" expression='getCTAllocationTotal(currentZone.zoneCode, currentDay)'/>
    </component>

    <component id="insertDayHeader" type="Insert">
        <binding name="format" expression='dateFormatter'/>
        <static-binding name="raw">true</static-binding>
        <binding name="value" expression='components.forEachDay.value'/>
    </component>

    <component id="insertZoneCapTotal" type="Insert">
        <binding name="value" expression='getZoneCapacityTotal(currentZone.zoneCode, getDays())'/>
    </component>

    <component id="insertZoneName" type="Insert">
        <binding name="value" expression='currentZone.displayName'/>
    </component>

    <component id="insertZoneAllocationTotal" type="Insert">
        <binding name="value" expression='getZoneAllocationTotal(currentZone.zoneCode, getDays())'/>
    </component>

    <component id="selectDay" type="PropertySelection">
        <binding name="model" expression='engine.getDaySelectionModel()'/>
        <binding name="value" expression='selectedDay'/>
    </component>

    <component id="selectRegion" type="PropertySelection">
        <binding name="model" expression='engine.getRegionSelectionModel()'/>
        <binding name="submitOnChange" expression='true'/>
        <binding name="value" expression='selectedRegion'/>
    </component>

    <component id="selectZone" type="PropertySelection">
        <binding name="model" expression='engine.getZoneSelectionModel(selectedRegion)'/>
        <binding name="value" expression='selectedZone'/>
    </component>

    <component id="sumbitFilterForm" type="Submit">
        <binding name="label" expression='"Submit"'/>
    </component>
    
    <component id="insertPercentage" type="Insert">
        <binding name="format" expression='getPercentageFormatter()'/>
        <binding name="value" expression='getPercentage(currentTimeslot)'/>
    </component>

    <component id="insertPercentageTotal" type="Insert">
        <binding name="format" expression='getPercentageFormatter()'/>
        <binding name="value" expression='getPercentageTotal(currentZone.zoneCode,currentDay)'/>
    </component>

</page-specification>
