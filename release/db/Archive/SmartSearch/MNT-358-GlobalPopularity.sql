-- NEW ANALYSIS TABLE
CREATE TABLE SS_GLOBAL_PRODUCT_SCORES (
   PRODUCT_ID VARCHAR2(48 BYTE),
   SCORE FLOAT NOT NULL,
   CONSTRAINT "GLOBAL_PRODUCT_SCORES_PK" PRIMARY KEY ("PRODUCT_ID")
);

-- MODIFY SO USER MATCHES (FDSTORE)
GRANT SELECT, INSERT, DELETE, UPDATE ON SS_GLOBAL_PRODUCT_SCORES TO FDSTORE;

-- POPULATION
-- USES SmartStore ANALYSIS TABLES
INSERT INTO SS_GLOBAL_PRODUCT_SCORES
SELECT ST.PARENT_CONTENT_ID AS PRODUCT_ID, COUNT(ST.PARENT_CONTENT_ID) AS SCORE
FROM SSA_ORDERLINE OL, SSA_STORE ST
WHERE ST.CONTENT_TYPE = 'Sku' and OL.SKU_CODE = ST.CONTENT_ID
GROUP BY ST.PARENT_CONTENT_ID;


