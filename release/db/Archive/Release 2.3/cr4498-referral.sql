--
-- REFERRAL_PROGRAM  (Table) 
--
CREATE TABLE "REFERRAL_PROGRAM"
(
"ID" VARCHAR2(16) NOT NULL,
"CAMPAIGN_CODE" VARCHAR2(16) NOT NULL,
"STATUS" VARCHAR2(10) NOT NULL,	-- 'NEW', 'DELETE', 'ACTIVE', 'USED'
"START_DATE" DATE NOT NULL,
"EXPIRATION_DATE" DATE NOT NULL,
"DESCRIPTION" VARCHAR2(255) NOT NULL,
CONSTRAINT "PK_REFERRAL_PROGRAM" PRIMARY KEY ("ID")
);


GRANT DELETE, INSERT, SELECT, UPDATE on CUST.REFERRAL_PROGRAM to fdstore_prda;
GRANT DELETE, INSERT, SELECT, UPDATE on CUST.REFERRAL_PROGRAM to fdstore_prdb;
GRANT SELECT on CUST.REFERRAL_PROGRAM to appdev;


--
-- REFERRAL  (Table) 
--
CREATE TABLE "REFERRAL"
(
"ID" VARCHAR2(16) NOT NULL,
"REFERRER_CUST_ID" VARCHAR2(16) NOT NULL,
"REFERRAL_DATE" DATE NOT NULL,
"STATUS" VARCHAR2(10),  -- 'SENT', 'REST', 'MAX_REF', 'FD_CUST', 'INEL'
"REFERRAL_PROG_ID" VARCHAR2(16),
CONSTRAINT "PK_REFERRAL" PRIMARY KEY ("ID")
);


--
-- REF_CUST_IDX  (Index) 
--
CREATE INDEX CUST.REF_CUST_IDX ON CUST.REFERRAL(REFERRER_CUST_ID);

--
-- REF_CUST_FK (Foreign Key)
--
ALTER TABLE REFERRAL ADD (CONSTRAINT REF_CUST_FK FOREIGN KEY (REFERRER_CUST_ID) REFERENCES CUST.CUSTOMER (ID));

GRANT DELETE, INSERT, SELECT, UPDATE on CUST.REFERRAL to fdstore_prda;
GRANT DELETE, INSERT, SELECT, UPDATE on CUST.REFERRAL to fdstore_prdb;
GRANT SELECT on CUST.REFERRAL to appdev;



--
-- REFERRAL_LOG  (Table) 
--
CREATE TABLE "REFERRAL_LOG"
(
"ID" VARCHAR2(16) NOT NULL,
"REFERRAL_ID" VARCHAR2(16) NOT NULL,
"ACTION_TYPE" VARCHAR2(10) NOT NULL, -- 'SENT'
"ACTION_DATE" DATE NOT NULL,
"REFERRAL_NAME" VARCHAR2(80),
"REFERRAL_EMAIL_ADDR" VARCHAR2(80) NOT NULL,
CONSTRAINT "PK_REFERRAL_LOG" PRIMARY KEY ("ID")
);


--
-- RL_REF_ID_IDX  (Index) 
--
CREATE INDEX CUST.RL_REF_ID_IDX ON CUST.REFERRAL_LOG(REFERRAL_ID);

--
-- RL_AT_IDX  (Index) 
--
CREATE INDEX CUST.RL_AT_IDX ON CUST.REFERRAL_LOG(ACTION_TYPE);

--
-- RL_AD_IDX  (Index) 
--
CREATE INDEX CUST.RL_AD_IDX ON CUST.REFERRAL_LOG(ACTION_DATE);

--
-- RL_EMAIL_ADDR_IDX (Index) 
--
CREATE INDEX CUST.RL_EMAIL_ADDR_IDX ON CUST.REFERRAL_LOG(REFERRAL_EMAIL_ADDR);
--
-- RL_REF_ID_FK (Foreign Key)
--
ALTER TABLE REFERRAL_LOG ADD (CONSTRAINT RL_REF_ID_FK FOREIGN KEY (REFERRAL_ID) REFERENCES CUST.REFERRAL (ID));

GRANT DELETE, INSERT, SELECT, UPDATE on CUST.REFERRAL_LOG to fdstore_prda;
GRANT DELETE, INSERT, SELECT, UPDATE on CUST.REFERRAL_LOG to fdstore_prdb;
GRANT SELECT on CUST.REFERRAL_LOG to appdev;

INSERT INTO CUST.REFERRAL_PROGRAM 
(
ID
, CAMPAIGN_CODE
, STATUS
, START_DATE
, EXPIRATION_DATE
, DESCRIPTION 
) 
VALUES (
'145034359'
, 'REF_PROG_1'
, 'ACT'
,  TO_Date( '06/16/2005 11:14:40 AM', 'MM/DD/YYYY HH:MI:SS AM')
,  TO_Date( '08/15/2007 11:14:40 AM', 'MM/DD/YYYY HH:MI:SS AM')
, 'Your Friend will save $5.00 on their first order.   After your friend places their 3rd order you''ll get $20 on your next order.'
); 

COMMIT;