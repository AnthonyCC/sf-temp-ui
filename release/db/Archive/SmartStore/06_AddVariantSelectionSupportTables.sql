--
-- Cohorts table
--
CREATE TABLE SS_COHORTS(
  "ID" VARCHAR2(16),
  "WEIGHT" NUMBER NOT NULL,
  CONSTRAINT "SS_COHORTS_PK" PRIMARY KEY ("ID")
) TABLESPACE "FDCUSDAT";

GRANT SELECT, INSERT, DELETE, UPDATE ON SS_COHORTS TO FDSTORE;

-- store default values
--
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C1',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C2',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C3',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C4',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C5',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C6',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C7',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C8',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C9',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C10',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C11',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C12',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C13',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C14',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C15',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C16',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C17',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C18',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C19',5);
INSERT INTO SS_COHORTS(ID,WEIGHT) VALUES('C20',5);

--
-- SMART STORE SERVICE CONFIGURATION TABLES
--

CREATE TABLE CUST.SS_SERVICE_CONFIGS (
  "ID" VARCHAR2(16),
  "TYPE" VARCHAR2(16) NOT NULL,
  CONSTRAINT "SS_SERVICE_CONFIGS_PK" PRIMARY KEY ("ID")
) TABLESPACE "FDCUSDAT";

GRANT SELECT, INSERT, DELETE, UPDATE ON SS_SERVICE_CONFIGS TO FDSTORE;

INSERT INTO SS_SERVICE_CONFIGS ("ID", "TYPE") VALUES('nil-dyf','nil');
INSERT INTO SS_SERVICE_CONFIGS ("ID", "TYPE") VALUES('freqbought-dyf','freqbought_dyf');
INSERT INTO SS_SERVICE_CONFIGS ("ID", "TYPE") VALUES('random-dyf','random_dyf');
INSERT INTO SS_SERVICE_CONFIGS ("ID", "TYPE") VALUES('comp1-test-dyf','composite');
INSERT INTO SS_SERVICE_CONFIGS ("ID", "TYPE") VALUES('comp0-test-dyf','composite');

--
-- Variants table
--
CREATE TABLE SS_VARIANTS(
  "ID" VARCHAR2(16),
  "CONFIG_ID" VARCHAR2(16) NOT NULL,
  "FEATURE" VARCHAR2(16) NOT NULL,

  CONSTRAINT "SS_VARIANTS_CONFIG_ID_FK" FOREIGN KEY ("CONFIG_ID")
     REFERENCES "SS_SERVICE_CONFIGS" ("ID") ENABLE,

  CONSTRAINT "SS_VARIANTS_ID_PK" PRIMARY KEY ("ID")

) TABLESPACE "FDCUSDAT";

GRANT SELECT, INSERT, DELETE, UPDATE ON CUST.SS_VARIANTS TO FDSTORE;

INSERT INTO CUST.SS_VARIANTS("ID","CONFIG_ID","FEATURE") VALUES('nil','nil-dyf','DYF');
INSERT INTO CUST.SS_VARIANTS("ID","CONFIG_ID","FEATURE") VALUES('freqbought','freqbought-dyf','DYF');
INSERT INTO CUST.SS_VARIANTS("ID","CONFIG_ID","FEATURE") VALUES('Random DYF','random-dyf','DYF');
INSERT INTO CUST.SS_VARIANTS("ID","CONFIG_ID","FEATURE") VALUES('Composite Test','comp1-test-dyf','DYF');


--
-- Cohort to Variant assignments table
--
CREATE TABLE SS_VARIANT_ASSIGNMENT(
  "COHORT_ID" VARCHAR2(16) NOT NULL,
  "DATE" DATE NOT NULL,
  "VARIANT_ID" VARCHAR2(16) NOT NULL,
  CONSTRAINT "SS_COHORT_FK" FOREIGN KEY ("COHORT_ID")
  REFERENCES "SS_COHORTS" ("ID") ENABLE, 
  CONSTRAINT "SS_VARIANT_FK" FOREIGN KEY ("VARIANT_ID")
  REFERENCES "SS_VARIANTS" ("ID") ENABLE
) TABLESPACE "FDCUSDAT";

CREATE INDEX "IDX_SS_VARIANT_ASSIGNMENT" ON SS_VARIANT_ASSIGNMENT ("COHORT_ID", "DATE") TABLESPACE "FDCUSDAT";

GRANT SELECT, INSERT, DELETE, UPDATE ON SS_VARIANT_ASSIGNMENT TO FDSTORE;


-- set default cohort to variant assignments
--
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C1', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C2', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C3', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C4', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C5', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C6', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C7', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C8', CURRENT_DATE, 'Random DYF');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C9', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C10', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C11', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C12', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C13', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C14', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C15', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C16', CURRENT_DATE, 'freqbought');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C17', CURRENT_DATE, 'nil');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C18', CURRENT_DATE, 'nil');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C19', CURRENT_DATE, 'nil');
INSERT INTO SS_VARIANT_ASSIGNMENT("COHORT_ID", "DATE", "VARIANT_ID") VALUES('C20', CURRENT_DATE, 'nil');
