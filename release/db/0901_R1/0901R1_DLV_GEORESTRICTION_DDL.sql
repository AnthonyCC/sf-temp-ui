ALTER TABLE DLV.SERVICETIME_SCENARIO ADD LATEDELIVERY_FACTOR  NUMBER(10,9) DEFAULT 1;

CREATE TABLE DLV.GEO_RESTRICTION_BOUNDARY
(
  CODE          VARCHAR2(16 BYTE)               NOT NULL,
  NAME          VARCHAR2(256 BYTE)              NOT NULL,
  GEOLOC        MDSYS.SDO_GEOMETRY NOT NULL  
);

ALTER TABLE DLV.GEO_RESTRICTION_BOUNDARY ADD (CONSTRAINT PK_GEO_RESTRICTION_BOUNDARY PRIMARY KEY (CODE));

ALTER TABLE DLV.GEO_RESTRICTION_BOUNDARY ADD UNIQUE (NAME);


CREATE TABLE DLV.GEO_RESTRICTION
(
  RESTRICTION_ID            VARCHAR2(16 BYTE)               NOT NULL,
  NAME          VARCHAR2(256 BYTE)              NOT NULL,  
  BOUNDARY_CODE  VARCHAR2(16 BYTE) NOT NULL,
  START_DATE    DATE NOT NULL,
  END_DATE    DATE NOT NULL,
  MESSAGE    VARCHAR2(1024 BYTE) NOT NULL,
  ACTIVE      VARCHAR2(1 BYTE),
  COMMENTS      VARCHAR2(255 BYTE) 
);

ALTER TABLE DLV.GEO_RESTRICTION ADD (CONSTRAINT PK_GEO_RESTRICTION PRIMARY KEY (RESTRICTION_ID));

ALTER TABLE DLV.GEO_RESTRICTION ADD UNIQUE (NAME);

ALTER TABLE DLV.GEO_RESTRICTION ADD (CONSTRAINT ACT_GEO_RESTRICTIONBC_FK FOREIGN KEY (BOUNDARY_CODE) REFERENCES DLV.GEO_RESTRICTION_BOUNDARY (CODE));

CREATE TABLE DLV.GEO_RESTRICTION_DAYS
(
  RESTRICTION_ID  VARCHAR2(16 BYTE)             NOT NULL,
  DAY_OF_WEEK     NUMBER                        NOT NULL,
  SEQNO           NUMBER                        NOT NULL,
  CONDITION       VARCHAR2(2 BYTE)              NOT NULL,
  START_TIME      DATE                          NOT NULL,
  END_TIME        DATE                          NOT NULL
);

ALTER TABLE DLV.GEO_RESTRICTION_DAYS ADD (CONSTRAINT PK_GEO_RESTRICTION_DAYS PRIMARY KEY (RESTRICTION_ID, DAY_OF_WEEK, SEQNO));

ALTER TABLE DLV.GEO_RESTRICTION_DAYS ADD (CONSTRAINT ACT_GEO_RESTRICTIONRI_FK FOREIGN KEY (RESTRICTION_ID) REFERENCES DLV.GEO_RESTRICTION (RESTRICTION_ID));

CREATE SEQUENCE DLV.GEO_RESTRICTION_SEQ
   START WITH 1
   MAXVALUE 1000000000000000000000000000
   MINVALUE 1
   NOCYCLE
   CACHE 20
   NOORDER;
   

---------------- START ALL TABLE GRANTS --------------------------------------------
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION_BOUNDARY TO FDSTORE_PRDA;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION_BOUNDARY TO FDSTORE_PRDB;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION_BOUNDARY TO FDTRN_PRDA;
GRANT SELECT ON DLV.GEO_RESTRICTION_BOUNDARY TO APPDEV;

GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION TO FDSTORE_PRDA;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION TO FDSTORE_PRDB;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION TO FDTRN_PRDA;
GRANT SELECT ON DLV.GEO_RESTRICTION TO APPDEV;

GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION_DAYS TO FDSTORE_PRDA;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION_DAYS TO FDSTORE_PRDB;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.GEO_RESTRICTION_DAYS TO FDTRN_PRDA;
GRANT SELECT ON DLV.GEO_RESTRICTION_DAYS TO APPDEV;

GRANT SELECT ON  DLV.GEO_RESTRICTION_SEQ TO FDTRN_PRDA;
GRANT SELECT ON  DLV.GEO_RESTRICTION_SEQ TO FDSTORE_PRDA;
GRANT SELECT ON  DLV.GEO_RESTRICTION_SEQ TO FDSTORE_PRDB;
GRANT SELECT ON  DLV.GEO_RESTRICTION_SEQ TO APPDEV;


---------------- END ALL TABLE GRANTS --------------------------------------------

insert into user_sdo_geom_metadata select 'GEO_RESTRICTION_BOUNDARY',column_name,diminfo,srid from user_sdo_geom_metadata where table_name = 'NAVTECH_GEOCODE';

CREATE INDEX GEO_RESTRICTION_BOUNDARY_SX ON DLV.GEO_RESTRICTION_BOUNDARY(GEOLOC) INDEXTYPE IS MDSYS.SPATIAL_INDEX;


