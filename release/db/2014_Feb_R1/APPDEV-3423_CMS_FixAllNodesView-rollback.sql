--
-- Restore CMS ALL_NODE view
--

DROP MATERIALIZED VIEW LOG ON relationship;
DROP MATERIALIZED VIEW LOG ON relationshipdefinition;
drop materialized view all_nodes;


CREATE MATERIALIZED VIEW LOG ON RELATIONSHIP
WITH PRIMARY KEY EXCLUDING NEW VALUES;

CREATE MATERIALIZED VIEW LOG ON RELATIONSHIPDEFINITION
WITH PRIMARY KEY ( "CONTENTTYPE_ID", "NAME", "NAVIGABLE" ) EXCLUDING NEW VALUES;

CREATE MATERIALIZED VIEW ALL_NODES
REFRESH FAST ON COMMIT
DISABLE QUERY REWRITE
AS SELECT * FROM RELATIONSHIP R
WHERE  EXISTS (SELECT 'x' FROM RELATIONSHIPDEFINITION RD 
WHERE RD.NAME=R.DEF_NAME AND RD.NAVIGABLE='T');


--
-- Restore grants on CMS PROD and CMS TEST
--
grant select on all_nodes to fdstore;
grant select on all_nodes to cust;
grant select on all_nodes to cssi;
grant select on all_nodes to appdev;

