ALTER TABLE CUST.ORDERLINE
ADD (SUSTAINABILITY_RATING VARCHAR2(3 BYTE));

DROP MATERIALIZED VIEW ERPS.PRODUCT;
CREATE MATERIALIZED VIEW ERPS.PRODUCT 
TABLESPACE FDERPDAT
PCTUSED    0
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOCACHE
LOGGING
NOCOMPRESS
NOPARALLEL
BUILD IMMEDIATE
USING INDEX
            TABLESPACE FDERPDAT
            PCTFREE    10
            INITRANS   2
            MAXTRANS   255
            STORAGE    (
                        INITIAL          64K
                        MINEXTENTS       1
                        MAXEXTENTS       UNLIMITED
                        PCTINCREASE      0
                        BUFFER_POOL      DEFAULT
                       )
REFRESH FORCE
START WITH TO_DATE('08-Mar-2011 18:04:15','dd-mon-yyyy hh24:mi:ss')
NEXT sysdate + 1/144 
WITH PRIMARY KEY
AS 
/* Formatted on 3/7/2011 6:02:54 PM (QP5 v5.139.911.3011) */
SELECT PRODUCT.ID ID,
       PRODUCT.VERSION VERSION,
       PRODUCT.SKU_CODE SKU_CODE,
       PRODUCT.UNAVAILABILITY_STATUS UNAVAILABILITY_STATUS,
       PRODUCT.UNAVAILABILITY_DATE UNAVAILABILITY_DATE,
       PRODUCT.UNAVAILABILITY_REASON UNAVAILABILITY_REASON,
       PRODUCT.RATING RATING,
       PRODUCT.SUSTAINABILITY_RATING,
       PRODUCT.DAYS_FRESH DAYS_FRESH,
       PRODUCT.DAYS_IN_HOUSE DAYS_IN_HOUSE
  FROM ERPS.PRODUCT@DBSTO.NYC.FRESHDIRECT.COM PRODUCT;

COMMENT ON MATERIALIZED VIEW ERPS.PRODUCT IS 'snapshot table for snapshot ERPS.PRODUCT';

CREATE UNIQUE INDEX ERPS.IDX_PRD_SKU_VER ON ERPS.PRODUCT
(SKU_CODE, VERSION)
LOGGING
TABLESPACE FDERPIDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE UNIQUE INDEX ERPS.IDX_PRD_SKU_VER_UNV ON ERPS.PRODUCT
(SKU_CODE, VERSION, UNAVAILABILITY_STATUS)
LOGGING
TABLESPACE FDERPDAT
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE UNIQUE INDEX ERPS.PK_PRD ON ERPS.PRODUCT
(ID)
LOGGING
TABLESPACE FDERPDAT
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE UNIQUE INDEX ERPS.PRODUCT_IDX_001 ON ERPS.PRODUCT
(ID, SKU_CODE, VERSION)
LOGGING
TABLESPACE FDERPIDX
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE INDEX ERPS.PRODUCT_SKU_AVAIL_VERSION_IDX ON ERPS.PRODUCT
(SKU_CODE, UNAVAILABILITY_STATUS, VERSION)
LOGGING
TABLESPACE FDERPDAT
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

CREATE INDEX ERPS.PRODUCT_VERSION_SKU_AVAIL_IDX ON ERPS.PRODUCT
(VERSION, SKU_CODE, UNAVAILABILITY_STATUS)
LOGGING
TABLESPACE FDERPDAT
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;

GRANT DELETE, INSERT, SELECT, UPDATE ON ERPS.PRODUCT TO APPDEV;

GRANT DELETE, INSERT, SELECT, UPDATE ON ERPS.PRODUCT TO FDSTORE_PRDA;

GRANT DELETE, INSERT, SELECT, UPDATE ON ERPS.PRODUCT TO FDSTORE_PRDB;

GRANT DELETE, INSERT, SELECT, UPDATE ON ERPS.PRODUCT TO FDSTORE_STSTG01;