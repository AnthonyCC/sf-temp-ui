/*Event Log Scripts*/

CREATE TABLE TRANSP.EVENTLOGBOOK
(
  ID                    VARCHAR2(32 BYTE)       NOT NULL,
  EVENTDATE             DATE                    NOT NULL,
  ROUTENUMBER           VARCHAR2(10 BYTE),
  TRUCKNUMBER           VARCHAR2(12 BYTE),
  ROUTEWINDOWSTARTTIME  DATE,
  ROUTEWINDOWENDTIME    DATE,
  EVENTTYPE             VARCHAR2(40 BYTE),
  EVENTSUBTYPE          VARCHAR2(40 BYTE),
  EVENTDESCRIPTION      VARCHAR2(250 BYTE),
  CROSSSTREETS          VARCHAR2(40 BYTE),
  EMPLOYEENUMBER        VARCHAR2(30 BYTE),
  SCANNERNUMBER         VARCHAR2(30 BYTE),
  DATECREATED           DATE,
  CREATEDBY             VARCHAR2(30 BYTE),
  REFERENCETICKETID     VARCHAR2(16 BYTE)
);

CREATE INDEX TRANSP.IDX_EL_BOOK_DATE ON TRANSP.EVENTLOGBOOK (EVENTDATE);

ALTER TABLE TRANSP.EVENTLOGBOOK ADD ( CONSTRAINT PK_EVENTLOG_BOOK PRIMARY KEY (ID));

CREATE TABLE TRANSP.EVENTLOG_MESSAGEGROUP
(
  GROUP_NAME   VARCHAR2(45 BYTE)                NOT NULL,
  EMAIL        VARCHAR2(45 BYTE),
  CREATEDBY    VARCHAR2(45 BYTE),
  CROMOD_DATE  DATE
);

ALTER TABLE TRANSP.EVENTLOG_MESSAGEGROUP ADD (PRIMARY KEY (GROUP_NAME));

CREATE TABLE TRANSP.EVENTSTOPNUMBERBREAKDOWN
(
  STOPNUMBER  NUMBER(6),
  EVENTLOGID  VARCHAR2(40 BYTE)
);

ALTER TABLE TRANSP.EVENTSTOPNUMBERBREAKDOWN ADD ( CONSTRAINT FK_EVENTLOG_ID FOREIGN KEY (EVENTLOGID)  REFERENCES TRANSP.EVENTLOGBOOK (ID));

CREATE INDEX TRANSP.IDX_EL_STOP ON TRANSP.EVENTSTOPNUMBERBREAKDOWN (STOPNUMBER);

CREATE TABLE TRANSP.EVENTTYPE
(
  ID                    VARCHAR2(40 BYTE)       NOT NULL,
  EVENTTYPENAME         VARCHAR2(40 BYTE)      NOT NULL,
  EVENTTYPEDESCRIPTION  VARCHAR2(45 BYTE),
  CREATEDBY             VARCHAR2(30 BYTE),
  DATECREATED           DATE,
  ISEMPLOYEEREQUIRED    VARCHAR2(1 BYTE),
  ISLOCATIONREQUIRED    VARCHAR2(1 BYTE),
  ISACTIVE              VARCHAR2(1 BYTE)
);

ALTER TABLE TRANSP.EVENTTYPE ADD ( PRIMARY KEY (ID));

CREATE TABLE TRANSP.EVENTSUBTYPE
(
  ID                       VARCHAR2(40 BYTE)    NOT NULL,
  EVENTSUBTYPENAME         VARCHAR2(45 BYTE)    NOT NULL,
  EVENTSUBTYPEDESCRIPTION  VARCHAR2(45 BYTE),
  EVENTTYPEID              VARCHAR2(45 BYTE)    NOT NULL,
  CREATEDBY                VARCHAR2(30 BYTE),
  DATECREATED              DATE,
  MSGGROUP_ID              VARCHAR2(45 BYTE),
  ISACTIVE                 VARCHAR2(1 BYTE)
);

ALTER TABLE TRANSP.EVENTSUBTYPE ADD ( CONSTRAINT FK_EVENTSUBTYPE_EVENTTYPEID FOREIGN KEY (EVENTTYPEID)  REFERENCES TRANSP.EVENTTYPE (ID));


ALTER TABLE TRANSP.EVENTSUBTYPE ADD (UNIQUE (ID, EVENTTYPEID));

ALTER TABLE TRANSP.EVENTSUBTYPE ADD ( CONSTRAINT FK_EVENTSUBTYPE_EVENTTYPEID  FOREIGN KEY (EVENTTYPEID)  REFERENCES TRANSP.EVENTTYPE (ID),
  CONSTRAINT FK_EVENTSUBTYPE_MSGGROUPID  FOREIGN KEY (MSGGROUP_ID)  REFERENCES TRANSP.EVENTLOG_MESSAGEGROUP (GROUP_NAME));

  
/*Mot EventLog scripts*/

CREATE TABLE TRANSP.MOTEVENTLOGBOOK
(
  ID                VARCHAR2(16 BYTE)           NOT NULL,
  EVENTDATE         DATE                        NOT NULL,
  ROUTENUMBER       VARCHAR2(10 BYTE)           NOT NULL,
  MOTROUTENUMBER    VARCHAR2(30 BYTE),
  NEXTELNUMBER      VARCHAR2(12 BYTE),
  EVENTTYPEID       VARCHAR2(40 BYTE)           NOT NULL,
  EVENTDESCRIPTION  VARCHAR2(250 BYTE),
  TICKETNUMBER      VARCHAR2(40 BYTE),
  ISVERIFIED        VARCHAR2(1 BYTE),
  DATEVERIFIED     DATE,
  VERIFIEDBY       VARCHAR2(30 BYTE),
  DATECREATED       DATE,
  CREATEDBY         VARCHAR2(30 BYTE)
);

CREATE INDEX TRANSP.IDX_MOTEL_BOOK_DATE ON TRANSP.MOTEVENTLOGBOOK (EVENTDATE);

ALTER TABLE TRANSP.MOTEVENTLOGBOOK ADD ( CONSTRAINT PK_MOTEVENTLOG_BOOK PRIMARY KEY (ID));

CREATE TABLE TRANSP.MOTEVENTLOG_MESSAGEGROUP
(
  GROUP_NAME   VARCHAR2(45 BYTE)                NOT NULL,
  EMAIL        VARCHAR2(45 BYTE),
  CREATEDBY    VARCHAR2(45 BYTE),
  CROMOD_DATE  DATE
);

ALTER TABLE TRANSP.MOTEVENTLOG_MESSAGEGROUP ADD ( PRIMARY KEY (GROUP_NAME));

CREATE TABLE TRANSP.MOTSTOPNUMBERBREAKDOWN
(
  MOTSTOPNUMBER  NUMBER(6),
  MOTEVENTLOGID  VARCHAR2(40 BYTE)
);

CREATE INDEX TRANSP.IDX_MOTEL_STOP ON TRANSP.MOTSTOPNUMBERBREAKDOWN(MOTSTOPNUMBER);

ALTER TABLE TRANSP.MOTSTOPNUMBERBREAKDOWN ADD ( CONSTRAINT FK_MOTEVENTLOG_ID FOREIGN KEY (MOTEVENTLOGID) REFERENCES TRANSP.MOTEVENTLOGBOOK (ID));

CREATE TABLE TRANSP.MOTEVENTTYPE
(
  ID                       VARCHAR2(40 BYTE)    NOT NULL,
  MOTEVENTTYPENAME         VARCHAR2(40 BYTE)    NOT NULL,
  MOTEVENTTYPEDESCRIPTION  VARCHAR2(45 BYTE),
  MSGGROUP_ID              VARCHAR2(45 BYTE),
  CREATEDBY                VARCHAR2(30 BYTE),
  DATECREATED              DATE,
  ISACTIVE                 VARCHAR2(1 BYTE)
);

ALTER TABLE TRANSP.MOTEVENTTYPE ADD ( PRIMARY KEY (ID));

ALTER TABLE TRANSP.MOTEVENTTYPE ADD ( CONSTRAINT FK_MOTEVTSUBTYPE_GROUPID FOREIGN KEY (MSGGROUP_ID) REFERENCES TRANSP.MOTEVENTLOG_MESSAGEGROUP (GROUP_NAME));

CREATE SEQUENCE TRANSP.EVENTLOGSEQ
  START WITH 1
  MAXVALUE 100000000000000000
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER;
  
CREATE SEQUENCE TRANSP.MOTEVENTLOGSEQ
  START WITH 1
  MAXVALUE 100000000000000000
  MINVALUE 1
  NOCYCLE
  CACHE 20
  NOORDER;
  

CREATE TABLE TRANSP.AUTHUSERS
(
  USERNAME     VARCHAR2(45 BYTE)                NOT NULL,
  REALNAME     VARCHAR2(45 BYTE),
  EMPLOYEEID   VARCHAR2(10 BYTE),
  DATECREATED  DATE                             DEFAULT sysdate
);

ALTER TABLE TRANSP.AUTHUSERS ADD ( CONSTRAINT PK_EVENTLOG_USER PRIMARY KEY (USERNAME));

CREATE TABLE TRANSP.AUTHUSER_PRIVILEGE
(
  USERNAME        VARCHAR2(55 BYTE)             NOT NULL,
  PRIVILEGE_NAME  VARCHAR2(80 BYTE)             NOT NULL
);

ALTER TABLE TRANSP.AUTHUSER_PRIVILEGE ADD ( UNIQUE (USERNAME, PRIVILEGE_NAME));

ALTER TABLE TRANSP.AUTHUSER_PRIVILEGE ADD ( CONSTRAINT FK_AUTHUSER FOREIGN KEY (USERNAME) REFERENCES TRANSP.AUTHUSERS (USERNAME));

/*Table to capture order delivery metric*/
CREATE TABLE MIS.ORDER_DELIVERY_METRIC
(
  INSERT_TIMESTAMP    DATE                      NOT NULL,
  WEBORDER_ID         VARCHAR2(16 BYTE)         NOT NULL,
  ROUTE_NO            VARCHAR2(16 BYTE)         NOT NULL,
  ROUTING_ROUTE_NO    VARCHAR2(10 BYTE)         NOT NULL,
  STOP_SEQUENCE       NUMBER(9)                 NOT NULL,
  DLV_ATTEMPTED_FLAG  VARCHAR2(1 BYTE),
  LATEISSUE_FLAG      VARCHAR2(1 BYTE),
  EVENTLOG_FLAG       VARCHAR2(1 BYTE),
  ORDER_MAXSCANTIME   DATE,
  ROUTE_MAXSCANTIME   DATE,
  EMBARK_NEXTTIME     DATE,
  WORK_TIME           NUMBER,
  MIN_UNTIL_DELIVERY  NUMBER,
  ESTIMATED_DLV_TIME  DATE
);

ALTER TABLE MIS.ORDER_DELIVERY_METRIC ADD ( PRIMARY KEY (WEBORDER_ID));
