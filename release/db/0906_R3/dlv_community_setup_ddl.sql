CREATE MATERIALIZED VIEW DLV.COMMUNITY_WORKTAB 
TABLESPACE FDDLVDAT
NOCACHE
LOGGING
NOCOMPRESS
NOPARALLEL
BUILD IMMEDIATE
USING INDEX
            TABLESPACE FDDLVDAT
REFRESH COMPLETE
START WITH sysdate
NEXT trunc(sysdate+1)+1/24+1/24/60 
WITH ROWID
AS 
SELECT "COMMUNITY_WORKTAB"."CODE" "CODE","COMMUNITY_WORKTAB"."NAME" "NAME","COMMUNITY_WORKTAB"."MI_SYMBOLOGY" "MI_SYMBOLOGY","COMMUNITY_WORKTAB"."MI_PRINX" "MI_PRINX","COMMUNITY_WORKTAB"."GEOLOC" "GEOLOC" FROM "DLV"."COMMUNITY_WORKTAB"@DBSTG.NYC.FRESHDIRECT.COM "COMMUNITY_WORKTAB";


GRANT SELECT ON DLV.COMMUNITY_WORKTAB TO fdstore_prda;
GRANT SELECT ON DLV.COMMUNITY_WORKTAB TO fdstore_prdb;
GRANT SELECT ON DLV.COMMUNITY_WORKTAB TO fdtrn_prda;
GRANT SELECT ON DLV.COMMUNITY_WORKTAB TO appdev;


insert into user_sdo_geom_metadata select 'COMMUNITY_WORKTAB',column_name,diminfo,srid from user_sdo_geom_metadata where table_name = 'NJ_ZONE_WORKTABLE'

CREATE INDEX COMMUNITY_WORKTAB_SX ON COMMUNITY_WORKTAB(GEOLOC) INDEXTYPE IS MDSYS.SPATIAL_INDEX

EXEC DBMS_MVIEW.REFRESH('COMMUNITY_WORKTAB', 'A', '', TRUE, FALSE, 0,0,0, FALSE);



CREATE TABLE DLV.COMMUNITY
(
  CODE          VARCHAR2(16 BYTE)               NOT NULL,
  NAME          VARCHAR2(256 BYTE)              NOT NULL,
  DELIVERYMODEL       VARCHAR2(8 BYTE)          DEFAULT '003'                 NOT NULL,
  GEOLOC        MDSYS.SDO_GEOMETRY NOT NULL  
);

ALTER TABLE DLV.COMMUNITY ADD (CONSTRAINT PK_COMMUNITY PRIMARY KEY (CODE));

ALTER TABLE DLV.COMMUNITY ADD UNIQUE (NAME);


   

---------------- START ALL TABLE GRANTS --------------------------------------------
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.COMMUNITY TO FDSTORE_PRDA;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.COMMUNITY TO FDSTORE_PRDB;
GRANT DELETE, INSERT, SELECT, UPDATE ON  DLV.COMMUNITY TO FDTRN_PRDA;
GRANT SELECT ON DLV.COMMUNITY TO APPDEV;

---------------- END ALL TABLE GRANTS --------------------------------------------

insert into user_sdo_geom_metadata select 'COMMUNITY',column_name,diminfo,srid from user_sdo_geom_metadata where table_name = 'NAVTECH_GEOCODE';

CREATE INDEX COMMUNITY_SX ON DLV.COMMUNITY(GEOLOC) INDEXTYPE IS MDSYS.SPATIAL_INDEX;






